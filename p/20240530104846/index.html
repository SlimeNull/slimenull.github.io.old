<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='åœ¨ WPF ä¸­æ­£ç¡®çš„ä½¿ç”¨äº‘æ¯, äºšå…‹åŠ›ç­‰é€æ˜èƒŒæ™¯æè´¨, ä»¥åŠè¿›è¡Œäº®æš—ä¸»é¢˜åˆ‡æ¢'><title>[.NET,WPF] çª—ä½“äº‘æ¯, äºšå…‹åŠ›, é€æ˜, æ··åˆé¢œè‰², æ¨¡ç³ŠèƒŒæ™¯, äº®æš—è‰²ä¸»é¢˜å…¨è®²</title>
<link rel=canonical href=https://slimenull.com/p/20240530104846/><link rel=stylesheet href=/scss/style.min.73438a911857e6d491e39369614d0dd0c0302dcacfb43e15034e0e48cac08c07.css><meta property='og:title' content='[.NET,WPF] çª—ä½“äº‘æ¯, äºšå…‹åŠ›, é€æ˜, æ··åˆé¢œè‰², æ¨¡ç³ŠèƒŒæ™¯, äº®æš—è‰²ä¸»é¢˜å…¨è®²'><meta property='og:description' content='åœ¨ WPF ä¸­æ­£ç¡®çš„ä½¿ç”¨äº‘æ¯, äºšå…‹åŠ›ç­‰é€æ˜èƒŒæ™¯æè´¨, ä»¥åŠè¿›è¡Œäº®æš—ä¸»é¢˜åˆ‡æ¢'><meta property='og:url' content='https://slimenull.com/p/20240530104846/'><meta property='og:site_name' content='SlimeNull Blogs'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='#dotnet'><meta property='article:tag' content='win32'><meta property='article:tag' content='winapi'><meta property='article:tag' content='wpf'><meta property='article:published_time' content='2024-05-30T10:48:46+08:00'><meta property='article:modified_time' content='2024-05-30T10:48:46+08:00'><meta name=twitter:title content="[.NET,WPF] çª—ä½“äº‘æ¯, äºšå…‹åŠ›, é€æ˜, æ··åˆé¢œè‰², æ¨¡ç³ŠèƒŒæ™¯, äº®æš—è‰²ä¸»é¢˜å…¨è®²"><meta name=twitter:description content="åœ¨ WPF ä¸­æ­£ç¡®çš„ä½¿ç”¨äº‘æ¯, äºšå…‹åŠ›ç­‰é€æ˜èƒŒæ™¯æè´¨, ä»¥åŠè¿›è¡Œäº®æš—ä¸»é¢˜åˆ‡æ¢"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu11436448765783238083.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>SlimeNull Blogs</a></h1><h2 class=site-description>ä¸ºäº†æ›´å¥½çš„å¼€æºä¸–ç•Œ~</h2></div></header><ol class=social-menu><li><a href=https://github.com/SlimeNull target=_blank title=GitHub rel=me><!doctype html><svg t="1702542119184" class="icon" viewBox="0 0 1024 1024" p-id="4136" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M692.906667 938.666667A42.666667 42.666667.0 01650.24 896V785.066667A91.733333 91.733333.0 00627.2 714.24a42.666667 42.666667.0 0126.026667-71.253333c104.106666-12.373334 200.106666-45.653334 200.106666-226.133334a170.666667 170.666667.0 00-28.586666-94.72A117.333333 117.333333.0 01807.253333 234.24a158.293333 158.293333.0 000-60.16A326.4 326.4.0 00718.08 220.586667a42.666667 42.666667.0 01-35.84 6.4 433.066667 433.066667.0 00-235.52.0 42.666667 42.666667.0 01-35.84-6.4A315.733333 315.733333.0 00320.853333 174.08a150.186667 150.186667.0 000 60.16 121.173333 121.173333.0 01-18.346666 88.746667A173.653333 173.653333.0 00273.92 418.133333C273.92 584.106666 354.133333 628.48 474.453333 643.84A42.666667 42.666667.0 01509.44 672a42.666667 42.666667.0 01-8.96 42.666667 87.893333 87.893333.0 00-23.466667 66.56V896A42.666667 42.666667.0 01391.68 896v-24.32a256 256 0 01-224.853333-89.173333A166.4 166.4.0 00117.333333 744.96a42.666667 42.666667.0 1121.333334-82.773333A210.346667 210.346667.0 01224 720.213333c42.666667 42.666667 85.333333 80.213333 166.4 64.853334a165.973333 165.973333.0 019.813333-67.413334C312.32 695.466666 186.88 632.32 186.88 418.986667a256 256 0 0142.666667-142.08 36.266667 36.266667.0 005.546666-26.453334 242.773333 242.773333.0 0114.08-136.96 42.666667 42.666667.0 0126.88-24.32c14.506667-4.266667 66.56-12.8 165.12 51.2a518.826667 518.826667.0 01242.773334.0c98.56-64 150.613333-55.893333 164.693333-51.2a42.666667 42.666667.0 0126.88 24.32A243.626667 243.626667.0 01889.6 250.88a32 32 0 004.693333 24.32A256 256 0 01936.96 417.706667c0 216.32-124.586667 279.04-213.333333 298.666666a182.613333 182.613333.0 019.386666 71.253334V896a42.666667 42.666667.0 01-40.106666 42.666667z" fill="#666" p-id="4137"/></svg></a></li><li><a href=https://space.bilibili.com/441842015 target=_blank title=Bilibili rel=me><!doctype html><svg t="1702541966104" class="icon" viewBox="0 0 1024 1024" p-id="16981" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M306.005333 117.632 444.330667 256h135.296l138.368-138.325333A42.666667 42.666667.0 01778.368 178.048L700.330667 256H789.333333A149.333333 149.333333.0 01938.666667 405.333333v341.333334A149.333333 149.333333.0 01789.333333 896H234.666667A149.333333 149.333333.0 0185.333333 746.666667V405.333333A149.333333 149.333333.0 01234.666667 256h88.96L245.632 177.962667a42.666667 42.666667.0 0160.373333-60.373334zm483.328 223.701333H234.666667a64 64 0 00-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0057.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0063.701334-57.856L853.333333 746.666667V405.333333a64 64 0 00-64-64zm-448 128A42.666667 42.666667.0 01384 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666666-42.666667zm341.333334.0A42.666667 42.666667.0 01725.333333 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666667-42.666667z" fill="#666" p-id="16982"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>é“¾æ¥</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://slimenull.com/ selected></option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#èƒŒæ™¯æ¨¡ç³Š-api>èƒŒæ™¯æ¨¡ç³Š API</a></li><li><a href=#åº”ç”¨äº‘æ¯æè´¨>åº”ç”¨äº‘æ¯æè´¨</a></li><li><a href=#åº”ç”¨äºšå…‹åŠ›æè´¨>åº”ç”¨äºšå…‹åŠ›æè´¨</a></li><li><a href=#åˆ‡æ¢çª—å£äº®æš—è‰²ä¸»é¢˜>åˆ‡æ¢çª—å£äº®æš—è‰²ä¸»é¢˜</a></li><li><a href=#è‡ªå®šä¹‰æ··åˆé¢œè‰²äºšå…‹åŠ›>è‡ªå®šä¹‰æ··åˆé¢œè‰²äºšå…‹åŠ›</a></li><li><a href=#ä»åº•å±‚ä¸Šæ»¡è¶³è°ƒç”¨æ¡ä»¶>ä»åº•å±‚ä¸Šæ»¡è¶³è°ƒç”¨æ¡ä»¶</a></li><li><a href=#é”™è¯¯å‚è€ƒ>é”™è¯¯å‚è€ƒ</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li><li><a href=#å¼•ç”¨>å¼•ç”¨</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/dotnet/ style=background-color:#512cd4;color:#fff>.NET
</a><a href=/categories/windows/>Windows
</a><a href=/categories/%E6%A1%8C%E9%9D%A2%E7%A8%8B%E5%BA%8F/>æ¡Œé¢ç¨‹åº</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/20240530104846/>[.NET,WPF] çª—ä½“äº‘æ¯, äºšå…‹åŠ›, é€æ˜, æ··åˆé¢œè‰², æ¨¡ç³ŠèƒŒæ™¯, äº®æš—è‰²ä¸»é¢˜å…¨è®²</a></h2><h3 class=article-subtitle>åœ¨ WPF ä¸­æ­£ç¡®çš„ä½¿ç”¨äº‘æ¯, äºšå…‹åŠ›ç­‰é€æ˜èƒŒæ™¯æè´¨, ä»¥åŠè¿›è¡Œäº®æš—ä¸»é¢˜åˆ‡æ¢</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 30, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 11 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>ä¼—æ‰€å‘¨çŸ¥, åœ¨ Windows10 ä¸­äºšå…‹åŠ›(Acrylic)æ•ˆæœè¢«æ·»åŠ , åœ¨ Windows11 ä¸­äº‘æ¯(Mica)æ•ˆæœè¢«æ·»åŠ . å…¶ä¸­äºšå…‹åŠ›æ•ˆæœç®€å•æ¥è®²å°±æ˜¯å¯¹çª—ä½“åçš„å…ƒç´ æ¨¡ç³Šå†åŠ å™ªç‚¹. Mica åˆ™æ˜¯å¯¹å£çº¸è¿›è¡Œæ¨¡ç³Šå†åŠ å™ªç‚¹.</p><div class=table-wrapper><table><thead><tr><th>åç§°</th><th>å®ç°</th><th>æ•ˆæœ</th><th>æ€§èƒ½</th><th>æ¨èç”¨äº</th></tr></thead><tbody><tr><td>æ¯›ç»ç’ƒ/Aero</td><td>é€æ˜+æ¨¡ç³Š</td><td>å¥½</td><td>æœ€å·®</td><td>æˆ‘ä¸çŸ¥é“æ–°ç‰ˆæœ¬æ“ä½œç³»ç»Ÿæ€ä¹ˆå¯ç”¨ Aero</td></tr><tr><td>äºšå…‹åŠ›/Acrylic</td><td>é€æ˜+æ¨¡ç³Š+å™ªç‚¹</td><td>å¥½</td><td>è¾ƒå·®</td><td>ä¸´æ—¶çª—å£, ä¾‹å¦‚å³é”®èœå•, å·¥å…·æç¤ºç­‰</td></tr><tr><td>äº‘æ¯/Mica</td><td>å£çº¸é‡‡æ ·+æ¨¡ç³Š+å™ªç‚¹</td><td>è¾ƒå¥½</td><td>æœ€å¥½</td><td>ä¸»çª—å£</td></tr></tbody></table></div><p>äº‘æ¯æ•ˆæœçš„æ€§èƒ½ä¹‹æ‰€ä»¥å¥½, æ˜¯å› ä¸ºå®ƒä¸ä¼šå¯¹å£çº¸è¿›è¡Œé‡å¤é‡‡æ ·, è€Œæ˜¯åªé‡‡æ ·ä¸€æ¬¡, ç”Ÿæˆå¯¹åº”äº‘æ¯æ•ˆæœè´´å›¾, æœ€ååªéœ€è¦å°†å®ƒåº”ç”¨åˆ°çª—å£ä¸Šå°±å¯ä»¥. å¯ä»¥è¯´, åŸºæœ¬ä¸Šæ²¡æœ‰ä»»ä½•æ¶ˆè€—.</p><p>ä½†è¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›å¼Šç«¯, å‡å¦‚ä½ ä½¿ç”¨äº†æŸç§åŠ¨æ€å£çº¸è½¯ä»¶, é‚£ä¹ˆäº‘æ¯æ•ˆæœå’Œä½ çš„å£çº¸æ˜¯å®Œå…¨ä¸åŒ¹é…çš„, è¿™ç¨ç¨å½±å“äº†ç¾è§‚.</p><blockquote><p>åœ¨é˜…è¯»æœ¬æ–‡ç« ä¹‹å‰, è¯·ç¡®ä¿ä½ æœ‰è¿›è¡Œ .NET è°ƒç”¨éæ‰˜ç®¡åŠ¨æ€é“¾æ¥åº“å‡½æ•°çš„ç»éªŒ, å¤§è‡´çŸ¥é“ <code>WindowChrome</code> ç±»çš„ä½œç”¨, çŸ¥é“çª—å£å¥æŸ„æ˜¯ä»€ä¹ˆä¸œè¥¿.
é˜…è¯»æ—¶è¯·ä»å¼€å§‹åˆ°ç»“æŸæŒ‰é¡ºåºçœ‹, å¦åˆ™å¯èƒ½ä¼šçœ‹æ¼æŸäº›ç»†èŠ‚ä¸Šçš„ä¸œè¥¿.</p></blockquote><br><h2 id=èƒŒæ™¯æ¨¡ç³Š-api>èƒŒæ™¯æ¨¡ç³Š API</h2><p>åœ¨ Windows ä¸­, æœ‰ä¸¤ä¸ª API å¯ä»¥ç”¨æ¥å®ç°èƒŒæ™¯æ¨¡ç³Š:</p><div class=table-wrapper><table><thead><tr><th></th><th>DwmSetWindowAttribute</th><th>SetWindowCompositionAttribute</th></tr></thead><tbody><tr><td>å¯ä»¥å®ç°çš„åŠŸèƒ½</td><td>äº®æš—è‰²æ¨¡å¼çš„äº‘æ¯ä¸äºšå…‹åŠ›æ•ˆæœ</td><td>æ”¯æŒè‡ªå®šä¹‰æ··åˆé¢œè‰²çš„äºšå…‹åŠ›æ•ˆæœ, æ¨¡ç³Šé€æ˜æ•ˆæœ</td></tr><tr><td>æ¨¡ç³ŠåŒºåŸŸ</td><td>èƒ½å¤Ÿåº”ç”¨åˆ°æ•´ä¸ªçª—å£, åŒ…æ‹¬æ ‡é¢˜æ ä»¥åŠçª—å£å†…å®¹</td><td>åªèƒ½å¯¹çª—å£å†…å®¹è¿›è¡Œæ¨¡ç³Š</td></tr><tr><td>ç³»ç»Ÿè¦æ±‚</td><td>API éœ€è¦ Windows Vista åŠä»¥ä¸Šç‰ˆæœ¬, äº®æš—è‰²ä¸»é¢˜, äº‘æ¯å’Œäºšå…‹åŠ›æ•ˆæœåˆ™åªèƒ½åœ¨ Windows11 ä¸Šç”¨, å…¶ä¸­äº®æš—è‰²éœ€è¦ç‰ˆæœ¬ 22000, æ¨¡ç³ŠèƒŒæ™¯éœ€è¦ç‰ˆæœ¬ 22621</td><td>API åœ¨ Windows 7 åŠä»¥ä¸Šç‰ˆæœ¬å¯ç”¨, äºšå…‹åŠ›ä¸æ¨¡ç³ŠèƒŒæ™¯æ•ˆæœåˆ™åªèƒ½åœ¨ Windows10 ä¸Šå¯ç”¨, å…·ä½“ç‰ˆæœ¬æœªçŸ¥, å› ä¸ºè¿™æ˜¯æœªåœ¨å¾®è½¯æ–‡æ¡£ä¸­å…·ä½“å†™æ˜çš„ API</td></tr><tr><td>å…¶ä»–è¦æ±‚</td><td>åªæœ‰åœ¨ &ldquo;çª—å£æ¡†æ¶&rdquo; æ‹“å±•åˆ°çª—å£å·¥ä½œåŒºå†…æ—¶, æ‹“å±•çš„åšåº¦æ‰ä¼šå¸¦æœ‰å¯¹åº”æ¨¡ç³Šæ•ˆæœ.</td><td>åªæœ‰åœ¨ &ldquo;çª—å£æ¡†æ¶&rdquo; ä¸æ‹“å±•åˆ°çª—å£å·¥ä½œåŒºå†…æ—¶æœ‰æ•ˆ.</td></tr><tr><td>ä¼˜ç‚¹</td><td>é€šè¿‡è®¾ç½®é¢œè‰²ä¸»é¢˜å³å¯ç›´æ¥è‡ªåŠ¨æ¢æ‰äº‘æ¯æˆ–äºšå…‹åŠ›èƒŒæ™¯çš„é¢œè‰²</td><td>åœ¨çª—å£å¤±å»ç„¦ç‚¹æ—¶, æ¨¡ç³Šä»ç„¶æœ‰æ•ˆ, å¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰æ··åˆé¢œè‰²</td></tr><tr><td>ç¼ºç‚¹</td><td>å½“çª—ä½“å¤±å»ç„¦ç‚¹çš„æ—¶å€™, æ¨¡ç³Šæ•ˆæœä¼šæ¶ˆå¤±</td><td>æ²¡æœ‰äº‘æ¯æ•ˆæœ</td></tr></tbody></table></div><p>ä¸¤ API åœ¨ C# çš„å£°æ˜åˆ†åˆ«å¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[DllImport(&#34;DWMAPI&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kd>extern</span> <span class=n>nint</span> <span class=n>DwmSetWindowAttribute</span><span class=p>(</span><span class=n>nint</span> <span class=n>hwnd</span><span class=p>,</span> <span class=n>DwmWindowAttribute</span> <span class=n>attribute</span><span class=p>,</span> <span class=n>nint</span> <span class=n>dataPointer</span><span class=p>,</span> <span class=kt>uint</span> <span class=n>dataSize</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[DllImport(&#34;User32&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kd>extern</span> <span class=kt>bool</span> <span class=n>SetWindowCompositionAttribute</span><span class=p>(</span><span class=n>nint</span> <span class=n>hwnd</span><span class=p>,</span> <span class=k>ref</span> <span class=n>WindowCompositionAttributeData</span> <span class=n>data</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>å®ƒä»¬ä¾èµ–çš„, ç”¨äºè®¾ç½® &ldquo;çª—å£æ¡†æ¶&rdquo; æ‹“å±•åšåº¦çš„ API å£°æ˜å¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[DllImport(&#34;DWMAPI&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kd>extern</span> <span class=n>nint</span> <span class=n>DwmExtendFrameIntoClientArea</span><span class=p>(</span><span class=n>nint</span> <span class=n>hwnd</span><span class=p>,</span> <span class=k>ref</span> <span class=n>Margins</span> <span class=n>margins</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“æ„ä½“ä¸æšä¸¾å£°æ˜å¦‚ä¸‹:</p><p>DWM å±æ€§æšä¸¾</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>DwmWindowAttribute</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NCRENDERING_ENABLED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>NCRENDERING_POLICY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TRANSITIONS_FORCEDISABLED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ALLOW_NCPAINT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>CAPTION_BUTTON_BOUNDS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>NONCLIENT_RTL_LAYOUT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>FORCE_ICONIC_REPRESENTATION</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>FLIP3D_POLICY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>EXTENDED_FRAME_BOUNDS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_ICONIC_BITMAP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DISALLOW_PEEK</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>EXCLUDED_FROM_PEEK</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>CLOAK</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>CLOAKED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>FREEZE_REPRESENTATION</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PASSIVE_UPDATE_MODE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>USE_HOSTBACKDROPBRUSH</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨æš—è‰²æ¨¡å¼, å®ƒä¼šå°†çª—ä½“çš„æ¨¡ç³ŠèƒŒæ™¯è°ƒæ•´ä¸ºæš—è‰²</span>
</span></span><span class=line><span class=cl>    <span class=n>USE_IMMERSIVE_DARK_MODE</span> <span class=p>=</span> <span class=m>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>WINDOW_CORNER_PREFERENCE</span> <span class=p>=</span> <span class=m>33</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BORDER_COLOR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>CAPTION_COLOR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TEXT_COLOR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>VISIBLE_FRAME_BORDER_THICKNESS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// èƒŒæ™¯ç±»å‹, å€¼å¯ä»¥æ˜¯: è‡ªåŠ¨, æ— , äº‘æ¯, æˆ–è€…äºšå…‹åŠ›</span>
</span></span><span class=line><span class=cl>    <span class=n>SYSTEMBACKDROP_TYPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>LAST</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>èƒŒæ™¯ç±»å‹æšä¸¾:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>WindowBackdrop</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Auto</span> <span class=p>=</span> <span class=m>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>None</span> <span class=p>=</span> <span class=m>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>MainWindow</span> <span class=p>=</span> <span class=m>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TransientWindow</span> <span class=p>=</span> <span class=m>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TabbedWindow</span> <span class=p>=</span> <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è®¾ç½® <code>SetWindowCompositionAttribute</code> æ‰€ç”¨çš„æ•°æ®ç»“æ„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[StructLayout(LayoutKind.Sequential)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>struct</span> <span class=nc>WindowCompositionAttributeData</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// A flag describing which value to get or set, specified as a value of the &lt;see cref=&#34;WindowCompositionAttribute&#34;/&gt; enumeration. </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// This parameter specifies which attribute to get or set, and the pvData member points to an object containing the attribute value.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>WindowCompositionAttribute</span> <span class=n>Attribute</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// When used with the GetWindowCompositionAttribute function, this member contains a pointer to a variable that will hold the value of the requested attribute when the function returns. &lt;br/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// When used with the SetWindowCompositionAttribute function, it points an object containing the attribute value to set. &lt;br/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The type of the value set depends on the value of the Attrib member.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>nint</span> <span class=n>DataPointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The size of the object pointed to by the pvData member, in bytes.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>uint</span> <span class=n>DataSize</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨ <code>SetWindowCompositionAttribute</code> è®¾ç½®èƒŒæ™¯æ¨¡ç³Šæ—¶æ‰€éœ€è¦ç”¨åˆ°çš„å±æ€§æšä¸¾</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>WindowCompositionAttribute</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// çœç•¥å…¶ä»–æœªä½¿ç”¨çš„å­—æ®µ</span>
</span></span><span class=line><span class=cl>    <span class=n>WcaAccentPolicy</span> <span class=p>=</span> <span class=m>19</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// çœç•¥å…¶ä»–æœªä½¿ç”¨çš„å­—æ®µ</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨ <code>SetWindowCompositionAttribute</code> è®¾ç½®èƒŒæ™¯æ¨¡ç³Šéœ€è¦å®é™…ä¼ å…¥çš„æ•°æ®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[StructLayout(LayoutKind.Sequential)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>struct</span> <span class=nc>AccentPolicy</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>AccentState</span> <span class=n>AccentState</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>AccentFlags</span> <span class=n>AccentFlags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>GradientColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>AnimationId</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Accent state, å³åœ¨çª—å£ä¸Šè¦ä½¿ç”¨åˆ°çš„æ•ˆæœ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>AccentState</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Disabled</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>EnableGradient</span> <span class=p>=</span> <span class=m>1</span><span class=p>,</span>           <span class=c1>// æ¸å˜ (å®æµ‹æ²¡ä»€ä¹ˆç”¨)</span>
</span></span><span class=line><span class=cl>    <span class=n>EnableTransparent</span> <span class=p>=</span> <span class=m>2</span><span class=p>,</span>        <span class=c1>// é€æ˜ (å®æµ‹æ²¡ä»€ä¹ˆç”¨)</span>
</span></span><span class=line><span class=cl>    <span class=n>EnableBlurBehind</span> <span class=p>=</span> <span class=m>3</span><span class=p>,</span>         <span class=c1>// èƒŒæ™¯æ¨¡ç³Š (æœ‰ç”¨)</span>
</span></span><span class=line><span class=cl>    <span class=n>EnableAcrylicBlurBehind</span> <span class=p>=</span> <span class=m>4</span><span class=p>,</span>  <span class=c1>// èƒŒæ™¯äºšå…‹åŠ›æ¨¡ç³Š (æœ‰ç”¨)</span>
</span></span><span class=line><span class=cl>    <span class=n>EnableHostBackdrop</span> <span class=p>=</span> <span class=m>5</span><span class=p>,</span>       <span class=c1>// æ²¡å•¥ç”¨</span>
</span></span><span class=line><span class=cl>    <span class=n>InvalidState</span> <span class=p>=</span> <span class=m>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Accent flags, æ§åˆ¶æŸäº›è¡Œä¸º, ç”±äºæ²¡æœ‰æ–‡æ¡£, ä¸‹é¢çš„å€¼éƒ½æ˜¯æµ‹è¯•å‡ºæ¥çš„:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[Flags]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>AccentFlags</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>None</span> <span class=p>=</span> <span class=m>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ExtendSize</span> <span class=p>=</span> <span class=m>0x4</span><span class=p>,</span>      <span class=c1>// å¯ç”¨æ­¤ flag ä¼šå¯¼è‡´çª—ä½“å¤§å°æ‹“å±•è‡³å±å¹•å¤§å°</span>
</span></span><span class=line><span class=cl>    <span class=n>LeftBorder</span> <span class=p>=</span> <span class=m>0x20</span><span class=p>,</span>     <span class=c1>// å¯ç”¨çª—å£å·¦ä¾§è¾¹æ¡† (å½“ WindowStyle ä¸º None æ—¶å¯ä»¥çœ‹å‡ºæ¥)</span>
</span></span><span class=line><span class=cl>    <span class=n>TopBorder</span> <span class=p>=</span> <span class=m>0x40</span><span class=p>,</span>      <span class=c1>// å¯ç”¨çª—å£é¡¶éƒ¨è¾¹æ¡† (åŒä¸Š)</span>
</span></span><span class=line><span class=cl>    <span class=n>RightBorder</span> <span class=p>=</span> <span class=m>0x80</span><span class=p>,</span>    <span class=c1>// å¯ç”¨çª—å£å³ä¾§è¾¹æ¡† (åŒä¸Š)</span>
</span></span><span class=line><span class=cl>    <span class=n>BottomBorder</span> <span class=p>=</span> <span class=m>0x100</span><span class=p>,</span>  <span class=c1>// å¯ç”¨çª—å£åº•éƒ¨è¾¹æ¡†</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆèµ·æ¥, å¯ç”¨çª—å£æ‰€æœ‰è¾¹æ¡†</span>
</span></span><span class=line><span class=cl>    <span class=n>AllBorder</span> <span class=p>=</span> <span class=n>LeftBorder</span> <span class=p>|</span> <span class=n>TopBorder</span> <span class=p>|</span> <span class=n>RightBorder</span> <span class=p>|</span> <span class=n>BottomBorder</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è®¾ç½® &ldquo;çª—å£æ‹“å±•&rdquo; éœ€è¦ç”¨åˆ°çš„è¡¨ç¤ºæ‹“å±•å¤§å°çš„ç»“æ„. å½“å€¼ä¸º -1 æ—¶è¡¨ç¤ºæ— ç©·å¤§.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[StructLayout(LayoutKind.Sequential)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>struct</span> <span class=nc>Margins</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>LeftWidth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>RightWidth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>TopHeight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>BottomHeight</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><br><h2 id=åº”ç”¨äº‘æ¯æè´¨>åº”ç”¨äº‘æ¯æè´¨</h2><p>è¦å¯¹ WPF çš„çª—å£è¿›è¡Œæ“ä½œ, æˆ‘ä»¬éœ€è¦æ‹¿åˆ°çª—å£çš„å¥æŸ„, ç„¶åè°ƒç”¨åˆšåˆšæåˆ°çš„ API è¿›è¡Œæ“ä½œ.</p><p>ä¸è¿‡åœ¨è¿™ä¹‹å‰, æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ä¸€ä»¶äº‹. WPF è¦åº”ç”¨èƒŒæ™¯é€æ˜æ¨¡ç³Šæ•ˆæœ, è¿˜éœ€è¦è®¾ç½®çª—å£å¯¹åº” <code>HwndSource</code> çš„ <code>CompositionTarget</code> çš„ <code>BackgroundColor</code> ä¸º <code>Transparent</code> æ‰èƒ½æ­£ç¡®çš„çœ‹åˆ°é€æ˜èƒŒæ™¯. é™¤æ­¤ä¹‹å¤–, ä½ ä¹Ÿéœ€è¦ç¡®è®¤çª—å£çš„ <code>Background</code> ä¹Ÿæ˜¯ <code>Transparent</code>, å¦åˆ™çª—å£é¢œè‰²é®æŒ¡èƒŒæ™¯, ä½ å°±çœ‹ä¸åˆ°äº†.</p><p>ç”±äºåœ¨ WPF ç¨‹åºä¸­, ä¸€åˆ‡éƒ½æŠ½è±¡æˆäº† WPF çš„å¯¹è±¡, è€Œå¯¹äºçª—å£è¿™ä¸€ç±»å‹æ¥è®², åœ¨å®ƒè¢«è°ƒç”¨ Show æ–¹æ³•ä¹‹å‰, æ˜¯ä¸ä¼šåˆ›å»º Win32 çª—å£çš„. è¦ä¿è¯æˆ‘ä»¬èƒ½å¤ŸæŒæœ‰çª—å£å¥æŸ„, æœ‰ä¸¤ç§æ–¹æ¡ˆ:</p><ul><li>ä½¿ç”¨ <code>WindowsInteropHelper</code> çš„ <code>EnsureHandle</code> æ–¹æ³•, ç¡®ä¿çª—å£å¯¹è±¡åˆ›å»ºäº† Win32 çª—å£å¹¶å¯ä»¥ä½¿ç”¨å¥æŸ„.</li><li>è®¢é˜…çª—å£çš„ <code>SourceInitialized</code> äº‹ä»¶, è¯¥äº‹ä»¶ä¼šåœ¨çª—å£çš„ Win32 çª—å£è¢«åˆ›å»ºä¹‹åå¼•å‘.</li></ul><p>ä¸‹é¢æˆ‘ä»¬ä»¥ <code>SourceInitialized</code> äº‹ä»¶çš„äº‹ä»¶å¤„ç†å™¨ä¸­ç¼–å†™é€»è¾‘ä¸¾ä¾‹, è®²è¿°å¦‚ä½•æ­£ç¡®çš„åœ¨ WPF ä¸­åº”ç”¨äº‘æ¯æ•ˆæœ.</p><p>é¦–å…ˆ, ç¡®ä¿æˆ‘ä»¬çš„çª—å£èƒŒæ™¯é¢œè‰²ä¸º <code>Transparent</code>, ä½ çš„ XAML ä»£ç åº”è¯¥åƒè¿™æ ·:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœä½ çš„è®¾ç½®æ— è¯¯, é‚£ä¹ˆä½ çš„çª—å£ç°åœ¨çš„ &ldquo;é€æ˜&rdquo; çœ‹èµ·æ¥åº”è¯¥æ˜¯ &ldquo;é»‘è‰²&rdquo;:</p><p><img src=/images/Pasted%20image%2020240530134522.png loading=lazy></p><p>ç„¶å, å®ç° <code>HwndSource</code> çš„ <code>CompositionTarget</code> è®¾ç½®å’Œ &ldquo;çª—å£æ¡†æ¶&rdquo;, æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥ä¸ºçª—å£è®¾ç½® <code>WindowChrome</code>, é€šè¿‡å¯¹ <code>WindowChrome</code> ç±»ä¸­åä¸º <code>WindowChrome</code> çš„é™„åŠ å±æ€§è¿›è¡Œèµ‹å€¼å³å¯, æœ€ååªéœ€è¦è®¾ç½® <code>GlassFrameThickness</code> ä¸º -1 å°±å®Œæˆäº†, åœ¨ XAML ä¸­è¿™æ ·ç¼–å†™:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;WindowChrome</span> <span class=na>GlassFrameThickness=</span><span class=s>&#34;-1&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>çª—å£è¾¹æ¡†æ‹“å±•å¤§å°</code> æ§åˆ¶äº†çª—å£è®¾ç½®çš„æ¨¡ç³ŠèƒŒæ™¯å»¶ä¼¸åˆ°çª—å£å†…éƒ¨çš„å¤§å°. ä¹Ÿå°±æ˜¯è¯´, å¦‚æœä½ å°† <code>GlassFrameThickness</code> è®¾ç½®ä¸º 10, é‚£ä¹ˆçª—å£è¾¹ç¼˜çš„ 10 åƒç´ ä¼šåº”ç”¨ä¸ŠæŒ‡å®šçš„èƒŒæ™¯. è€Œ -1 åœ¨è¿™é‡Œåˆ™è¡¨ç¤ºæ— é™å¤§.</p></blockquote><p>è¿™æ ·æ“ä½œä¹‹å, <code>WindowChrome</code> ä¼šå¸®æˆ‘ä»¬è®¾ç½®å¥½æ‰€éœ€çš„å±æ€§, å¦‚æœä½ çš„è®¾ç½®æ— è¯¯, ç°åœ¨çª—å£åº”è¯¥ä¼šæ¢å¤åˆ°åŸæ¥çš„ &ldquo;ç™½è‰²&rdquo;, å¹¶ä¸”çª—å£çš„æ ‡é¢˜æ ä¼š &ldquo;æ¶ˆå¤±&rdquo;, åªç•™ä¸‹ä¸‰ä¸ªçª—å£æŒ‰é’®:</p><p><img src=/images/Pasted%20image%2020240530134637.png loading=lazy></p><p>æœ€å, æˆ‘ä»¬è®¢é˜…çª—å£çš„ <code>SourceInitialized</code> äº‹ä»¶:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>SourceInitialized=</span><span class=s>&#34;Window_SourceInitialized&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;WindowChrome</span> <span class=na>GlassFrameThickness=</span><span class=s>&#34;-1&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>å¹¶æ·»åŠ ä»¥ä¸‹å¤„ç†:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>unsafe</span> <span class=k>void</span> <span class=n>Window_SourceInitialized</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>hwndSource</span> <span class=p>=</span> <span class=p>(</span><span class=n>HwndSource</span><span class=p>)</span><span class=n>PresentationSource</span><span class=p>.</span><span class=n>FromVisual</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>backdropType</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=m>2</span><span class=p>;</span>   <span class=c1>// 0 åˆ° 4 åˆ†åˆ«æ˜¯ &#39;è‡ªåŠ¨&#39;, &#39;æ— &#39;, &#39;äº‘æ¯(Mica)æ•ˆæœ&#39;, &#39;äºšå…‹åŠ›(Acrylic)æ•ˆæœ&#39;, &#39;äº‘æ¯å¤‡é€‰(Mica Alt)æ•ˆæœ&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>DwmSetWindowAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=n>DwmWindowAttribute</span><span class=p>.</span><span class=n>SYSTEMBACKDROP_TYPE</span><span class=p>,</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>backdropType</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>æ³¨æ„, åœ¨è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸å®‰å…¨ä»£ç å—, ä½ éœ€è¦åœ¨ä½ çš„é¡¹ç›®æ–‡ä»¶ä¸­å¯ç”¨ &ldquo;å…è®¸ä¸å®‰å…¨ä»£ç å—&rdquo; æ‰èƒ½ä½¿ç”¨æ­¤åŠŸèƒ½.</p></blockquote><p>æœ€åå¯åŠ¨çª—å£, æ“ä½œæ— è¯¯çš„è¯, ä½ æœ€ç»ˆçš„çª—å£, å·²ç»èƒ½å¤Ÿå‘ˆç°å‡ºäº‘æ¯æ•ˆæœäº†.</p><p><img src=/images/Pasted%20image%2020240530135314.png loading=lazy></p><br><h2 id=åº”ç”¨äºšå…‹åŠ›æè´¨>åº”ç”¨äºšå…‹åŠ›æè´¨</h2><p>åœ¨ä¸Šé¢, æˆ‘ä»¬å·²ç»æˆåŠŸå°†äº‘æ¯æè´¨åº”ç”¨åˆ°äº†çª—å£ä¸Š, å¦‚æœè¦æ¢æˆäºšå…‹åŠ›æ•ˆæœ, ä¹Ÿéå¸¸ç®€å•, åªéœ€è¦å°†è¡¨ç¤ºäº‘æ¯èƒŒæ™¯çš„ &ldquo;2&rdquo; æ¢æˆè¡¨ç¤ºäºšå…‹åŠ›çš„ &ldquo;3&rdquo; å³å¯, ä»£ç å¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>unsafe</span> <span class=k>void</span> <span class=n>Window_SourceInitialized</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>hwndSource</span> <span class=p>=</span> <span class=p>(</span><span class=n>HwndSource</span><span class=p>)</span><span class=n>PresentationSource</span><span class=p>.</span><span class=n>FromVisual</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>backdropType</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=m>3</span><span class=p>;</span>   <span class=c1>// 0 åˆ° 4 åˆ†åˆ«æ˜¯ &#39;è‡ªåŠ¨&#39;, &#39;æ— &#39;, &#39;äº‘æ¯(Mica)æ•ˆæœ&#39;, &#39;äºšå…‹åŠ›(Acrylic)æ•ˆæœ&#39;, &#39;äº‘æ¯å¤‡é€‰(Mica Alt)æ•ˆæœ&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>DwmSetWindowAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=n>DwmWindowAttribute</span><span class=p>.</span><span class=n>SYSTEMBACKDROP_TYPE</span><span class=p>,</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>backdropType</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>é‚£ä¹ˆ, æœ€ç»ˆçš„æ•ˆæœæ˜¯è¿™æ ·, å¯ä»¥çœ‹åˆ°çª—å£çš„èƒŒæ™¯æ˜¯å‚è€ƒäº†å…¶åæ–¹çª—å£å†…å®¹çš„:</p><p><img src=/images/Pasted%20image%2020240530140028.png loading=lazy></p><br><h2 id=åˆ‡æ¢çª—å£äº®æš—è‰²ä¸»é¢˜>åˆ‡æ¢çª—å£äº®æš—è‰²ä¸»é¢˜</h2><p>åœ¨ Windows11 çš„ 22000 ç‰ˆæœ¬ä¸­, <code>DwmSetWindowAttribute</code> æ”¯æŒäº†è¡¨ç¤ºçª—å£æ˜¯å¦ä½¿ç”¨æš—è‰²æ¨¡å¼çš„ <code>DWMWA_USE_IMMERSIVE_DARK_MODE</code> å±æ€§.</p><p>å½“æˆ‘ä»¬ä½¿ç”¨è¯¥ API è®¾ç½®è¯¥å±æ€§ä¸º 1 çš„æ—¶å€™, æ ‡é¢˜æ , ä»¥åŠäº‘æ¯ä¸äºšå…‹åŠ›ææ–™ä¼šåˆ‡æ¢åˆ°å¯¹åº”çš„æš—è‰². ä¸‹é¢, æˆ‘ä»¬å‘ä»£ç ä¸­æ·»åŠ å°†çª—å£è®¾ç½®ä¸ºæš—è‰²æ¨¡å¼çš„é€»è¾‘:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>unsafe</span> <span class=k>void</span> <span class=n>Window_SourceInitialized</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>hwndSource</span> <span class=p>=</span> <span class=p>(</span><span class=n>HwndSource</span><span class=p>)</span><span class=n>PresentationSource</span><span class=p>.</span><span class=n>FromVisual</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>backdropType</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=m>3</span><span class=p>;</span>   <span class=c1>// 0 åˆ° 3 åˆ†åˆ«æ˜¯ &#39;è‡ªåŠ¨&#39;, &#39;æ— &#39;, &#39;äº‘æ¯(Mica)æ•ˆæœ&#39;, &#39;äºšå…‹åŠ›(Acrylic)æ•ˆæœ&#39;</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>isDarkMode</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=m>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>DwmSetWindowAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=n>DwmWindowAttribute</span><span class=p>.</span><span class=n>SYSTEMBACKDROP_TYPE</span><span class=p>,</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>backdropType</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>DwmSetWindowAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=n>DwmWindowAttribute</span><span class=p>.</span><span class=n>USE_IMMERSIVE_DARK_MODE</span><span class=p>,</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>isDarkMode</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨æˆ‘ä»¬çš„äºšå…‹åŠ›çª—å£èƒŒæ™¯çœ‹èµ·æ¥æ¯”ä»¥å‰æš—äº†è®¸å¤š.</p><p><img src=/images/Pasted%20image%2020240530141132.png loading=lazy></p><p>å¦‚æœå®ƒçš„èƒŒæ™¯æ›´æš—ä¸€äº›, çª—å£çœ‹èµ·æ¥ä¹Ÿä¼šæ›´æš—:</p><p><img src=/images/Pasted%20image%2020240530141233.png loading=lazy></p><p>æˆ‘ä»¬å†å°†äºšå…‹åŠ›æè´¨æ¢æˆäº‘æ¯, å®ƒçš„æš—è‰²æ¨¡å¼çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„, å› ä¸ºå®ƒä¸å‚è€ƒçª—å£åçš„å†…å®¹, åªå‚è€ƒå£çº¸, æ‰€ä»¥æ— è®ºçª—å£åœ¨å“ª, å®ƒéƒ½æ˜¯è¿™å‰¯æ¨¡æ ·:</p><p><img src=/images/Pasted%20image%2020240530141400.png loading=lazy></p><p>åœ¨è°ƒæ•´çª—å£å†…å®¹å…ƒç´ å‰æ™¯ä¸èƒŒæ™¯è‰²åˆ°å¤§è‡´åˆé€‚çš„å€¼ä¹‹å, å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><p><img src=/images/Pasted%20image%2020240530141807.png loading=lazy></p><br><h2 id=è‡ªå®šä¹‰æ··åˆé¢œè‰²äºšå…‹åŠ›>è‡ªå®šä¹‰æ··åˆé¢œè‰²äºšå…‹åŠ›</h2><p>åœ¨ä¸Šé¢, æˆ‘ä»¬ä½¿ç”¨ <code>DwmSetWindowAttribute</code> å®ç°äº†çª—å£çš„äº‘æ¯ä¸äºšå…‹åŠ›èƒŒæ™¯, è€Œå®ƒä»¬å…·ä½“çš„é¢œè‰², åˆ™æ˜¯é€šè¿‡è®¾ç½®çª—å£æ˜¯å¦æ˜¯æš—è‰²å®ç°æ¥åˆ‡æ¢çš„. å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å åŠ çš„æ··åˆé¢œè‰², é‚£è¿™ä¸ª API å°±ä¸èƒ½å®ç°äº†.</p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>SetWindowCompositionAttribute</code> è¿™ä¸ª API æ¥å®ç°äº†. å½“ç„¶, åœ¨æœ€å¼€å§‹æˆ‘ä»¬ä¹Ÿäº†è§£è¿‡è¿™ä¸ª API çš„å¼Šç«¯äº†, æ‰€ä»¥, é™¤éä½ çœŸçš„æœ‰è¿™æ–¹é¢çš„éœ€æ±‚, å¦åˆ™å°½é‡ä½¿ç”¨æ–°çš„ API æ¯”è¾ƒå¥½.</p><p>åŒæ ·, åœ¨è°ƒç”¨ API ä¹‹å‰, éœ€è¦ç¡®ä¿æˆ‘ä»¬çš„çª—å£è®¾ç½®äº†æ­£ç¡®çš„å±æ€§, ç¬¬ä¸€ä¸ªæ˜¯èƒŒæ™¯é¢œè‰²éœ€è¦è®¾ä¸ºé€æ˜:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶å, éœ€è¦ç¡®ä¿ &ldquo;çª—å£æ¡†æ¶&rdquo; çš„æ‹“å±•å¤§å°æ˜¯ 0, ä¹Ÿå°±æ˜¯è¯´, Window å¿…é¡»ä¸è®¾ç½® <code>WindowChrome</code>, æˆ–è€… <code>WindowChrome</code> çš„ <code>GlassFrameThickness</code> å€¼éœ€è¦ä¸º 0. ä»¥ä¸‹ä¸¤ç§è®¾ç½®æ–¹å¼å‡å¯:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- è¿™é‡Œæ²¡æœ‰è®¾ç½®çª—å£çš„ WindowChrome --&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ–è€…è®¾ç½® <code>WindowChrome</code>, ä½†æ˜¯ <code>GlassFrameThickness</code> ä¸º 0:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;WindowChrome</span> <span class=na>GlassFrameThickness=</span><span class=s>&#34;0&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€å, ç¡®ä¿ <code>HwndSource.CompositionTarget.BackgroundColor</code> ä¸ºé€æ˜, æœ€æš´åŠ›çš„æ–¹å¼æ˜¯ç›´æ¥å°†çª—å£çš„ <code>AllowsTransparency</code> è®¾ä¸º <code>true</code>. åˆå› ä¸ºåªæœ‰ <code>WindowStyle</code> ä¸º <code>None</code> æ˜¯, çª—å£æ‰èƒ½è®¾ç½® <code>AllowsTransparency</code> ä¸º <code>true</code>, æ‰€ä»¥æœ€ç»ˆä½ çš„ XAML åƒæ˜¯è¿™æ ·:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>WindowStyle=</span><span class=s>&#34;None&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>AllowsTransparency=</span><span class=s>&#34;True&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>SourceInitialized=</span><span class=s>&#34;Window_SourceInitialized&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;WindowChrome</span> <span class=na>GlassFrameThickness=</span><span class=s>&#34;0&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>å°±æ­¤, æˆ‘ä»¬çš„å‡†å¤‡é˜¶æ®µå®Œæ¯•, æœ€åå°† <code>SourceInitialized</code> äº‹ä»¶å¤„ç†é€»è¾‘æ›´æ”¹ä¸ºä»¥ä¸‹ä»£ç :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>unsafe</span> <span class=k>void</span> <span class=n>Window_SourceInitialized</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>hwndSource</span> <span class=p>=</span> <span class=p>(</span><span class=n>HwndSource</span><span class=p>)</span><span class=n>PresentationSource</span><span class=p>.</span><span class=n>FromVisual</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>accentPolicy</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AccentPolicy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AccentState</span> <span class=p>=</span> <span class=n>AccentState</span><span class=p>.</span><span class=n>EnableAcrylicBlurBehind</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>AccentFlags</span> <span class=p>=</span> <span class=n>AccentFlags</span><span class=p>.</span><span class=n>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// æ³¨æ„, è¿™é‡Œä»é«˜ä½åˆ°ä½ä½åˆ†åˆ«æ˜¯ Alpha, Blue, Green, Red</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªé€šé“é¢œè‰²å€¼</span>
</span></span><span class=line><span class=cl>        <span class=n>GradientColor</span> <span class=p>=</span> <span class=m>0x338888FF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>WindowCompositionAttributeData</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Attribute</span> <span class=p>=</span> <span class=n>WindowCompositionAttribute</span><span class=p>.</span><span class=n>WcaAccentPolicy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>DataPointer</span> <span class=p>=</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>accentPolicy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>DataSize</span> <span class=p>=</span> <span class=p>(</span><span class=kt>uint</span><span class=p>)</span><span class=k>sizeof</span><span class=p>(</span><span class=n>AccentPolicy</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SetWindowCompositionAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=k>ref</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œå, å®ƒçš„æ•ˆæœæ˜¯åçº¢è‰²çš„äºšå…‹åŠ›çª—å£.</p><p><img src=/images/Pasted%20image%2020240530144501.png loading=lazy alt="Pasted image 20240530144501"></p><p>ç›¸ä¿¡ä½ ä¹Ÿä¸€å®šå‘ç°äº†ä¸€äº›é—®é¢˜, ç»è¿‡ä¸€ç•ªè®¾ç½®ä¹‹å, æˆ‘ä»¬çš„çª—å£:</p><ul><li>ç”±äºè®¾ç½®äº† <code>AllowsTransparency</code> ä¸º <code>True</code>, çª—å£ä¸­çš„ &ldquo;é€æ˜&rdquo; éƒ¨åˆ†, é¼ æ ‡äº‹ä»¶ä¼šç©¿é€å®ƒ, ä»è€Œç‚¹å‡»åˆ°çª—ä½“åæ–¹çš„å†…å®¹.</li><li>ç”±äºè®¾ç½®äº† <code>WindowStyle</code> ä¸º <code>None</code>, çª—å£æ ‡é¢˜æ æ²¡æœ‰äº†, æŒ‰é’®æ²¡æœ‰äº†, åœ†è§’æ²¡æœ‰äº†, æœ€å°åŒ–æœ€å¤§åŒ–ä¸å…³é—­çš„åŠ¨ç”»æ²¡æœ‰äº†.</li></ul><p>å…³äºç¬¬ä¸€ç‚¹, å¯ä»¥é€šè¿‡ä¸€ç§ç®€å•æš´åŠ›çš„æ–¹å¼æ¥è§£å†³, åªéœ€è¦ç»™çª—å£çš„ä¸é€æ˜åº¦ä¸€ä¸ªå¾ˆå°çš„å€¼, å³å¯:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;#01000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>WindowStyle=</span><span class=s>&#34;None&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>AllowsTransparency=</span><span class=s>&#34;True&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>SourceInitialized=</span><span class=s>&#34;Window_SourceInitialized&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;WindowChrome</span> <span class=na>GlassFrameThickness=</span><span class=s>&#34;0&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/WindowChrome.WindowChrome&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>è€Œç¬¬äºŒç‚¹, æœ¬è´¨ä¸Šæ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡è®¾ç½® <code>WindowStyle</code> ä»¥æ»¡è¶³è°ƒç”¨æ¡ä»¶å¯¼è‡´çš„, åªéœ€è¦æˆ‘ä»¬ä¸å»è®¾ç½® <code>WindowStyle</code>, ä»åº•å±‚ä¸Šè‡ªå·±æ»¡è¶³è°ƒç”¨æ¡ä»¶, å°±å¯ä»¥è§£å†³. å…·ä½“çš„æ“ä½œæ–¹å¼, è¯·ç»§ç»­å¾€ä¸‹çœ‹.</p><br><h2 id=ä»åº•å±‚ä¸Šæ»¡è¶³è°ƒç”¨æ¡ä»¶>ä»åº•å±‚ä¸Šæ»¡è¶³è°ƒç”¨æ¡ä»¶</h2><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­, ä¸ºäº†æ»¡è¶³ <code>DwmSetWindowAttribute</code> å’Œ <code>SetWindowCompositionAttribute</code> çš„è°ƒç”¨æ¡ä»¶, æˆ‘ä»¬ä½¿ç”¨äº† <code>WindowChrome.WindowChrome</code>, <code>WindowStyle</code>, <code>AllowsTransparency</code> å±æ€§. è€Œå®ƒä»¬ä¹Ÿéƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨:</p><ul><li><code>WindowChrome</code> ä¼šå»é™¤çª—å£è‡ªå¸¦çš„æ ‡é¢˜æ , ä½ è¿˜éœ€è¦æ‰‹åŠ¨ç”¨ WPF è‡ªå·±åšä¸€ä¸ªæ ‡é¢˜æ </li><li><code>WindowStyle</code> è®¾ä¸º <code>None</code> ä¼šå¯¼è‡´çª—å£çš„è¾¹æ¡†æ¶ˆå¤±, çª—å£æ“ä½œæŒ‰é’®æ¶ˆå¤±, åŠ¨ç”»æ¶ˆå¤±, åœ†è§’æ¶ˆå¤±.</li><li><code>AllowsTransparency</code> è®¾ä¸º <code>True</code> ä¼šå¯¼è‡´é€æ˜éƒ¨åˆ†ç©¿é€é¼ æ ‡äº‹ä»¶</li></ul><p>å®é™…ä¸Š, æœ€ç»ˆæˆ‘ä»¬éœ€è¦æ»¡è¶³çš„æ¡ä»¶ä¹Ÿåªæœ‰:</p><ul><li>çª—å£çš„èƒŒæ™¯è®¾ä¸ºé€æ˜, ä»¥èƒ½å¤ŸæŸ¥çœ‹åˆ°è®¾ç½®çš„çª—å£èƒŒæ™¯æ ·å¼</li><li><code>HwndSource.CompositionTarget.BackgroundColor</code> è®¾ä¸ºé€æ˜</li><li>å½“ä½¿ç”¨ <code>DwmSetWindowAttribute</code> æ—¶, &ldquo;çª—å£æ¡†æ¶&rdquo; çš„æ‹“å±•åšåº¦è®¾ç½®åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼, å½“ä½¿ç”¨ <code>SetWindowCompositionAttribute</code> æ—¶, &ldquo;çª—å£æ¡†æ¶&rdquo; çš„æ‹“å±•åšåº¦éœ€è¦è®¾ç½®ä¸º 0</li></ul><p>é‚£ä¹ˆç°åœ¨, æˆ‘ä»¬å°†å¤šä½™çš„å±æ€§åˆ å», ä»…ä¿ç•™çª—ä½“çš„ä»¥ä¸‹å±æ€§:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Window</span> <span class=err>...</span>
</span></span><span class=line><span class=cl>        <span class=na>Background=</span><span class=s>&#34;Transparent&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>SourceInitialized=</span><span class=s>&#34;Window_SourceInitialized&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/Window&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶ååœ¨ <code>SourceInitialized</code> æ”¹ä¸ºä»¥ä¸‹é€»è¾‘, æ¥å®ç°æ‰‹åŠ¨æ»¡è¶³æ¡ä»¶çš„äº‘æ¯æ•ˆæœ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>unsafe</span> <span class=k>void</span> <span class=n>Window_SourceInitialized</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å–å¾—çª—å£å¥æŸ„</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>hwndSource</span> <span class=p>=</span> <span class=p>(</span><span class=n>HwndSource</span><span class=p>)</span><span class=n>PresentationSource</span><span class=p>.</span><span class=n>FromVisual</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½® HwndSource.CompositionTarget.BackgroundColor ä¸ºé€æ˜</span>
</span></span><span class=line><span class=cl>    <span class=n>hwndSource</span><span class=p>.</span><span class=n>CompositionTarget</span><span class=p>.</span><span class=n>BackgroundColor</span> <span class=p>=</span> <span class=n>Colors</span><span class=p>.</span><span class=n>Transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½®è¾¹æ¡†</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>margins</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Margins</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LeftWidth</span> <span class=p>=</span> <span class=p>-</span><span class=m>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>TopHeight</span> <span class=p>=</span> <span class=p>-</span><span class=m>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>RightWidth</span> <span class=p>=</span> <span class=p>-</span><span class=m>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>BottomHeight</span> <span class=p>=</span> <span class=p>-</span><span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>DwmExtendFrameIntoClientArea</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=k>ref</span> <span class=n>margins</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½®èƒŒæ™¯</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>backdrop</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=m>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>DwmSetWindowAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=n>DwmWindowAttribute</span><span class=p>.</span><span class=n>SYSTEMBACKDROP_TYPE</span><span class=p>,</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>backdrop</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€åæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ª, å¸¦æœ‰çª—å£æ­£å¸¸æ ‡é¢˜æ ä¸äº‘æ¯èƒŒæ™¯çš„çª—å£:</p><p><img src=/images/Pasted%20image%2020240530152406.png loading=lazy></p><p>åŒç†, æˆ‘ä»¬æ‰‹åŠ¨å¤„ç† <code>SetWindowCompositionAttribute</code> çš„è°ƒç”¨æ¡ä»¶, XAML ä¸éœ€è¦æ›´æ”¹, åªéœ€è¦å°†é€»è¾‘æ”¹ä¸ºä¸‹é¢çš„ä»£ç :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>unsafe</span> <span class=k>void</span> <span class=n>Window_SourceInitialized</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å–å¾—çª—å£å¥æŸ„</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>hwndSource</span> <span class=p>=</span> <span class=p>(</span><span class=n>HwndSource</span><span class=p>)</span><span class=n>PresentationSource</span><span class=p>.</span><span class=n>FromVisual</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½® HwndSource.CompositionTarget.BackgroundColor ä¸ºé€æ˜</span>
</span></span><span class=line><span class=cl>    <span class=n>hwndSource</span><span class=p>.</span><span class=n>CompositionTarget</span><span class=p>.</span><span class=n>BackgroundColor</span> <span class=p>=</span> <span class=n>Colors</span><span class=p>.</span><span class=n>Transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½®è¾¹æ¡†</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>margins</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Margins</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LeftWidth</span> <span class=p>=</span> <span class=m>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>TopHeight</span> <span class=p>=</span> <span class=m>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>RightWidth</span> <span class=p>=</span> <span class=m>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>BottomHeight</span> <span class=p>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>DwmExtendFrameIntoClientArea</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=k>ref</span> <span class=n>margins</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½®èƒŒæ™¯</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>accentPolicy</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AccentPolicy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AccentState</span> <span class=p>=</span> <span class=n>AccentState</span><span class=p>.</span><span class=n>EnableAcrylicBlurBehind</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>AccentFlags</span> <span class=p>=</span> <span class=n>AccentFlags</span><span class=p>.</span><span class=n>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// æ³¨æ„, è¿™é‡Œä»é«˜ä½åˆ°ä½ä½åˆ†åˆ«æ˜¯ Alpha, Blue, Green, Red</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªé€šé“é¢œè‰²å€¼</span>
</span></span><span class=line><span class=cl>        <span class=n>GradientColor</span> <span class=p>=</span> <span class=m>0x338888FF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>WindowCompositionAttributeData</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Attribute</span> <span class=p>=</span> <span class=n>WindowCompositionAttribute</span><span class=p>.</span><span class=n>WcaAccentPolicy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>DataPointer</span> <span class=p>=</span> <span class=p>(</span><span class=n>nint</span><span class=p>)(</span><span class=k>void</span><span class=p>*)&amp;</span><span class=n>accentPolicy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>DataSize</span> <span class=p>=</span> <span class=p>(</span><span class=kt>uint</span><span class=p>)</span><span class=k>sizeof</span><span class=p>(</span><span class=n>AccentPolicy</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SetWindowCompositionAttribute</span><span class=p>(</span><span class=n>hwndSource</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=k>ref</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¸¦æœ‰ä¸é€æ˜æ ‡é¢˜æ ä¸è‡ªå®šä¹‰æ··åˆé¢œè‰²äºšå…‹åŠ›èƒŒæ™¯çš„çª—å£:</p><p><img src=/images/Pasted%20image%2020240530152815.png loading=lazy></p><br><h2 id=é”™è¯¯å‚è€ƒ>é”™è¯¯å‚è€ƒ</h2><p>ä¸‹é¢æ˜¯ä¸€äº›å±æ€§æ²¡æœ‰æ­£ç¡®è®¾ç½®ä¼šå¯¼è‡´çš„ç»“æœ:</p><p>çª—å£é¢œè‰²è¿‡æ›, æ²¡æœ‰å°† <code>HwndSource.CompositionTarget.BackgroundColor</code> è®¾ç½®ä¸ºé€æ˜å¯¼è‡´.</p><p><img src=/images/Pasted%20image%2020240530153159.png loading=lazy></p><p>çª—å£é»‘äº†, &ldquo;çª—å£è¾¹æ¡†&rdquo; æ‹“å±•å¤§å°äº API æ‰€éœ€å¤§å°ä¸åŒ¹é…å¯¼è‡´.</p><p><img src=/images/Pasted%20image%2020240530153317.png loading=lazy></p><br><h2 id=æ€»ç»“>æ€»ç»“</h2><p>å¯ä»¥ä½¿ç”¨ <code>DwmSetWindowAttribute</code> ä¸ <code>SetWindowCompositionAttribute</code> è®¾ç½®çª—å£çš„èƒŒæ™¯, å…¶ä¸­å‰è€…åªèƒ½ç”¨äº Windows11 ä¸Šè®¾ç½®äº®æš—çš„äº‘æ¯ä¸äºšå…‹åŠ›æè´¨, åè€…èƒ½å¤Ÿè®¾ç½®è‡ªå®šä¹‰æ··åˆé¢œè‰²çš„äºšå…‹åŠ›æè´¨. å‰è€…èƒ½å¤Ÿå°†æè´¨åº”ç”¨åˆ°æ ‡é¢˜æ ä¸å†…å®¹, è€Œåè€…åªèƒ½å°†ææ–™åº”ç”¨åˆ°å†…å®¹ä¸­.</p><p>è¿™ä¸¤ä¸ª API å‡æœ‰è‡ªå·±çš„ &ldquo;æ¡ä»¶&rdquo;, åªæœ‰æ¡ä»¶æ»¡è¶³, æ‰€æŒ‡å®šçš„èƒŒæ™¯æ‰èƒ½å¤Ÿè¢«ç”¨æˆ·çœ‹åˆ°. å¦åˆ™è¦ä¹ˆæ— ä½œç”¨, è¦ä¹ˆçª—å£çš„å†…å®¹å˜å¾—å¾ˆå¥‡æ€ª.</p><p>ä½¿ç”¨ <code>WindowChrome</code>, <code>WindowStyle</code> ä¸ <code>AllowsTransparency</code> çš„æ ¹æœ¬ç›®çš„æ˜¯æ»¡è¶³æ˜¾ç¤ºæŒ‡å®šèƒŒæ™¯, æˆ‘ä»¬å®Œå…¨å¯ä»¥è‡ªå·±å®Œæ•´è¿™ä¸€æ“ä½œ. è¿™æ ·å°±ä¸éœ€è¦æ‰¿æ‹…é‚£ä¸‰ä¸ªå±æ€§ä¼šå¯¼è‡´çš„å‰¯ä½œç”¨.</p><br><h2 id=å¼•ç”¨>å¼•ç”¨</h2><p>æ–‡ç« å‚è€ƒ:</p><ul><li><a class=link href=https://www.cnblogs.com/TwilightLemon/p/17479921.html target=_blank rel=noopener>WPFåœ¨win10/11ä¸Šå¯ç”¨æ¨¡ç³Šç‰¹æ•ˆ é€‚é…Dark/Light Mode - TwilightLemon)</a></li><li><a class=link href=https://blog.walterlv.com/post/win10/2017/10/02/wpf-transparent-blur-in-windows-10.html target=_blank rel=noopener>åœ¨ Windows 10 ä¸Šä¸º WPF çª—å£æ·»åŠ æ¨¡ç³Šç‰¹æ•ˆï¼ˆå°±åƒå¼€å§‹èœå•å’Œæ“ä½œä¸­å¿ƒé‚£æ ·ï¼‰ - walterlv</a></li><li><a class=link href=https://blog.walterlv.com/post/using-acrylic-in-wpf-application.html target=_blank rel=noopener>åœ¨ WPF ç¨‹åºä¸­åº”ç”¨ Windows 10 çœŸâ€¢äºšå…‹åŠ›æ•ˆæœ - walterlv</a></li><li><a class=link href=https://blog.walterlv.com/post/set-window-composition-attribute target=_blank rel=noopener>ä½¿ç”¨ SetWindowCompositionAttribute æ¥æ§åˆ¶ç¨‹åºçš„çª—å£è¾¹æ¡†å’ŒèƒŒæ™¯ï¼ˆå¯ä»¥åš Acrylic äºšå…‹åŠ›æ•ˆæœã€æ¨¡ç³Šæ•ˆæœã€ä¸»é¢˜è‰²æ•ˆæœç­‰ï¼‰ - walterlv</a></li></ul><p>ä»£ç å‚è€ƒ:</p><ul><li><a class=link href=https://github.com/TwilightLemon/MyToolBar target=_blank rel=noopener>TwilightLemon/MyToolBar: ä¸ºSurface Proè€Œç”Ÿçš„é¡¶éƒ¨å·¥å…·æ  æ”¯æŒè§¦æ§å’Œç¬”å¿«æ·æ–¹å¼ (github.com)</a></li><li><a class=link href=https://github.com/sourcechord/FluentWPF target=_blank rel=noopener>sourcechord/FluentWPF: Fluent Design System for WPF. (github.com)</a></li></ul><blockquote><p>æ³¨: ä¸Šé¢æåˆ°çš„æ–‡ç« å‚è€ƒå¯èƒ½åªä»‹ç»åˆ°äº† &ldquo;æŸä¸€éƒ¨åˆ†&rdquo; å†…å®¹, å¯èƒ½ä¼šé€ æˆè¯¯å¯¼, æ³¨æ„çœ‹å®Œæœ¬ç¯‡æ–‡ç« åè‡ªè¡ŒéªŒè¯</p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/%23dotnet/>#Dotnet</a>
<a href=/tags/win32/>Win32</a>
<a href=/tags/winapi/>Winapi</a>
<a href=/tags/wpf/>Wpf</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/20240523162351/><div class=article-details><h2 class=article-title>[WPF] EleCho.WpfSuite, æ§ä»¶, å¸ƒå±€å®¹å™¨, è¿‡æ¸¡åŠ¨ç”», æ ‡è®°æ‹“å±•ä»¥åŠå®ç”¨å·¥å…·</h2></div></a></article><article><a href=/p/20210211104239/><div class=article-details><h2 class=article-title>[C#] éŸ³ä¹æ’­æ”¾ 3 ç§æ–¹å¼ Demo ä¸ MCI éŸ³ä¹æ’­æ”¾å™¨å°è£…ç±».</h2></div></a></article><article><a href=/p/20230902090054/><div class=article-details><h2 class=article-title>[.NET] WPF æ•°æ®ç»‘å®šä¸ MVVM æ¨¡å‹</h2></div></a></article><article><a href=/p/20230902085924/><div class=article-details><h2 class=article-title>[.NET/WPF] è®¾ç½®æŒ‰é’®, ä»¥åŠå…¶ä»–ä»»ä½•åŒ…å«è¾¹æ¡†çš„æ§ä»¶çš„åœ†è§’</h2></div></a></article><article><a href=/p/20230818143649/><div class=article-details><h2 class=article-title>[.NET/WPF] CommunityToolkit.Mvvm å¼‚æ­¥æŒ‡ä»¤</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=SlimeNull/slimenull.github.io issue-term=pathname label=BlogComment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 SlimeNull Blogs</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>