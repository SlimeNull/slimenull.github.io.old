<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Windows on SlimeNull Blogs</title><link>https://slimenull.com/categories/windows/</link><description>Recent content in Windows on SlimeNull Blogs</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Thu, 30 May 2024 10:48:46 +0800</lastBuildDate><atom:link href="https://slimenull.com/categories/windows/index.xml" rel="self" type="application/rss+xml"/><item><title>[.NET,WPF] 窗体云母, 亚克力, 透明, 混合颜色, 模糊背景, 亮暗色主题全讲</title><link>https://slimenull.com/p/20240530104846/</link><pubDate>Thu, 30 May 2024 10:48:46 +0800</pubDate><guid>https://slimenull.com/p/20240530104846/</guid><description>&lt;p>众所周知, 在 Windows10 中亚克力(Acrylic)效果被添加, 在 Windows11 中云母(Mica)效果被添加. 其中亚克力效果简单来讲就是对窗体后的元素模糊再加噪点. Mica 则是对壁纸进行模糊再加噪点.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名称&lt;/th>
&lt;th>实现&lt;/th>
&lt;th>效果&lt;/th>
&lt;th>性能&lt;/th>
&lt;th>推荐用于&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>毛玻璃/Aero&lt;/td>
&lt;td>透明+模糊&lt;/td>
&lt;td>好&lt;/td>
&lt;td>最差&lt;/td>
&lt;td>我不知道新版本操作系统怎么启用 Aero&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>亚克力/Acrylic&lt;/td>
&lt;td>透明+模糊+噪点&lt;/td>
&lt;td>好&lt;/td>
&lt;td>较差&lt;/td>
&lt;td>临时窗口, 例如右键菜单, 工具提示等&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>云母/Mica&lt;/td>
&lt;td>壁纸采样+模糊+噪点&lt;/td>
&lt;td>较好&lt;/td>
&lt;td>最好&lt;/td>
&lt;td>主窗口&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>云母效果的性能之所以好, 是因为它不会对壁纸进行重复采样, 而是只采样一次, 生成对应云母效果贴图, 最后只需要将它应用到窗口上就可以. 可以说, 基本上没有任何消耗.&lt;/p>
&lt;p>但这也带来了一些弊端, 假如你使用了某种动态壁纸软件, 那么云母效果和你的壁纸是完全不匹配的, 这稍稍影响了美观.&lt;/p>
&lt;blockquote>
&lt;p>在阅读本文章之前, 请确保你有进行 .NET 调用非托管动态链接库函数的经验, 大致知道 &lt;code>WindowChrome&lt;/code> 类的作用, 知道窗口句柄是什么东西.
阅读时请从开始到结束按顺序看, 否则可能会看漏某些细节上的东西.&lt;/p>
&lt;/blockquote>
&lt;br />
&lt;h2 id="背景模糊-api">背景模糊 API&lt;/h2>
&lt;p>在 Windows 中, 有两个 API 可以用来实现背景模糊:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>DwmSetWindowAttribute&lt;/th>
&lt;th>SetWindowCompositionAttribute&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>可以实现的功能&lt;/td>
&lt;td>亮暗色模式的云母与亚克力效果&lt;/td>
&lt;td>支持自定义混合颜色的亚克力效果, 模糊透明效果&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>模糊区域&lt;/td>
&lt;td>能够应用到整个窗口, 包括标题栏以及窗口内容&lt;/td>
&lt;td>只能对窗口内容进行模糊&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>系统要求&lt;/td>
&lt;td>API 需要 Windows Vista 及以上版本, 亮暗色主题, 云母和亚克力效果则只能在 Windows11 上用, 其中亮暗色需要版本 22000, 模糊背景需要版本 22621&lt;/td>
&lt;td>API 在 Windows 7 及以上版本可用, 亚克力与模糊背景效果则只能在 Windows10 上可用, 具体版本未知, 因为这是未在微软文档中具体写明的 API&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>其他要求&lt;/td>
&lt;td>只有在 &amp;ldquo;窗口框架&amp;rdquo; 拓展到窗口工作区内时, 拓展的厚度才会带有对应模糊效果.&lt;/td>
&lt;td>只有在 &amp;ldquo;窗口框架&amp;rdquo; 不拓展到窗口工作区内时有效.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>优点&lt;/td>
&lt;td>通过设置颜色主题即可直接自动换掉云母或亚克力背景的颜色&lt;/td>
&lt;td>在窗口失去焦点时, 模糊仍然有效, 并且可以自定义混合颜色&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>缺点&lt;/td>
&lt;td>当窗体失去焦点的时候, 模糊效果会消失&lt;/td>
&lt;td>没有云母效果&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>两 API 在 C# 的声明分别如下:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[DllImport(&amp;#34;DWMAPI&amp;#34;)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">extern&lt;/span> &lt;span class="n">nint&lt;/span> &lt;span class="n">DwmSetWindowAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span> &lt;span class="n">hwnd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span> &lt;span class="n">attribute&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nint&lt;/span> &lt;span class="n">dataPointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="n">dataSize&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[DllImport(&amp;#34;User32&amp;#34;)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">extern&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="n">SetWindowCompositionAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span> &lt;span class="n">hwnd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="n">WindowCompositionAttributeData&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>它们依赖的, 用于设置 &amp;ldquo;窗口框架&amp;rdquo; 拓展厚度的 API 声明如下:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[DllImport(&amp;#34;DWMAPI&amp;#34;)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">extern&lt;/span> &lt;span class="n">nint&lt;/span> &lt;span class="n">DwmExtendFrameIntoClientArea&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span> &lt;span class="n">hwnd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="n">Margins&lt;/span> &lt;span class="n">margins&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>结构体与枚举声明如下:&lt;/p>
&lt;p>DWM 属性枚举&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NCRENDERING_ENABLED&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NCRENDERING_POLICY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TRANSITIONS_FORCEDISABLED&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ALLOW_NCPAINT&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CAPTION_BUTTON_BOUNDS&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NONCLIENT_RTL_LAYOUT&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FORCE_ICONIC_REPRESENTATION&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FLIP3D_POLICY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EXTENDED_FRAME_BOUNDS&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HAS_ICONIC_BITMAP&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DISALLOW_PEEK&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EXCLUDED_FROM_PEEK&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CLOAK&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CLOAKED&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FREEZE_REPRESENTATION&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PASSIVE_UPDATE_MODE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">USE_HOSTBACKDROPBRUSH&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 表示是否使用暗色模式, 它会将窗体的模糊背景调整为暗色&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">USE_IMMERSIVE_DARK_MODE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">20&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WINDOW_CORNER_PREFERENCE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">33&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BORDER_COLOR&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CAPTION_COLOR&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TEXT_COLOR&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">VISIBLE_FRAME_BORDER_THICKNESS&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 背景类型, 值可以是: 自动, 无, 云母, 或者亚克力&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SYSTEMBACKDROP_TYPE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LAST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>背景类型枚举:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">WindowBackdrop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Auto&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">None&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MainWindow&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TransientWindow&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">3&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TabbedWindow&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>设置 &lt;code>SetWindowCompositionAttribute&lt;/code> 所用的数据结构&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[StructLayout(LayoutKind.Sequential)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="nc">WindowCompositionAttributeData&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// A flag describing which value to get or set, specified as a value of the &amp;lt;see cref=&amp;#34;WindowCompositionAttribute&amp;#34;/&amp;gt; enumeration. &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// This parameter specifies which attribute to get or set, and the pvData member points to an object containing the attribute value.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">WindowCompositionAttribute&lt;/span> &lt;span class="n">Attribute&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// When used with the GetWindowCompositionAttribute function, this member contains a pointer to a variable that will hold the value of the requested attribute when the function returns. &amp;lt;br/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// When used with the SetWindowCompositionAttribute function, it points an object containing the attribute value to set. &amp;lt;br/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// The type of the value set depends on the value of the Attrib member.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">nint&lt;/span> &lt;span class="n">DataPointer&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// The size of the object pointed to by the pvData member, in bytes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="n">DataSize&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 &lt;code>SetWindowCompositionAttribute&lt;/code> 设置背景模糊时所需要用到的属性枚举&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">WindowCompositionAttribute&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 省略其他未使用的字段&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WcaAccentPolicy&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">19&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 省略其他未使用的字段&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 &lt;code>SetWindowCompositionAttribute&lt;/code> 设置背景模糊需要实际传入的数据&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[StructLayout(LayoutKind.Sequential)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="nc">AccentPolicy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">AccentState&lt;/span> &lt;span class="n">AccentState&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">AccentFlags&lt;/span> &lt;span class="n">AccentFlags&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">GradientColor&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">AnimationId&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Accent state, 即在窗口上要使用到的效果:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">AccentState&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Disabled&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EnableGradient&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 渐变 (实测没什么用)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EnableTransparent&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 透明 (实测没什么用)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EnableBlurBehind&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 背景模糊 (有用)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EnableAcrylicBlurBehind&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 背景亚克力模糊 (有用)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EnableHostBackdrop&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 没啥用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InvalidState&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">6&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Accent flags, 控制某些行为, 由于没有文档, 下面的值都是测试出来的:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[Flags]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">AccentFlags&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">None&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExtendSize&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 启用此 flag 会导致窗体大小拓展至屏幕大小&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LeftBorder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 启用窗口左侧边框 (当 WindowStyle 为 None 时可以看出来)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TopBorder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x40&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 启用窗口顶部边框 (同上)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RightBorder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x80&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 启用窗口右侧边框 (同上)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BottomBorder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 启用窗口底部边框&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 合起来, 启用窗口所有边框&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AllBorder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">LeftBorder&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="n">TopBorder&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="n">RightBorder&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="n">BottomBorder&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>设置 &amp;ldquo;窗口拓展&amp;rdquo; 需要用到的表示拓展大小的结构. 当值为 -1 时表示无穷大.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[StructLayout(LayoutKind.Sequential)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="nc">Margins&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">LeftWidth&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">RightWidth&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TopHeight&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">BottomHeight&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;br/>
&lt;h2 id="应用云母材质">应用云母材质&lt;/h2>
&lt;p>要对 WPF 的窗口进行操作, 我们需要拿到窗口的句柄, 然后调用刚刚提到的 API 进行操作.&lt;/p>
&lt;p>不过在这之前, 我们还需要知道一件事. WPF 要应用背景透明模糊效果, 还需要设置窗口对应 &lt;code>HwndSource&lt;/code> 的 &lt;code>CompositionTarget&lt;/code> 的 &lt;code>BackgroundColor&lt;/code> 为 &lt;code>Transparent&lt;/code> 才能正确的看到透明背景. 除此之外, 你也需要确认窗口的 &lt;code>Background&lt;/code> 也是 &lt;code>Transparent&lt;/code>, 否则窗口颜色遮挡背景, 你就看不到了.&lt;/p>
&lt;p>由于在 WPF 程序中, 一切都抽象成了 WPF 的对象, 而对于窗口这一类型来讲, 在它被调用 Show 方法之前, 是不会创建 Win32 窗口的. 要保证我们能够持有窗口句柄, 有两种方案:&lt;/p>
&lt;ul>
&lt;li>使用 &lt;code>WindowsInteropHelper&lt;/code> 的 &lt;code>EnsureHandle&lt;/code> 方法, 确保窗口对象创建了 Win32 窗口并可以使用句柄.&lt;/li>
&lt;li>订阅窗口的 &lt;code>SourceInitialized&lt;/code> 事件, 该事件会在窗口的 Win32 窗口被创建之后引发.&lt;/li>
&lt;/ul>
&lt;p>下面我们以 &lt;code>SourceInitialized&lt;/code> 事件的事件处理器中编写逻辑举例, 讲述如何正确的在 WPF 中应用云母效果.&lt;/p>
&lt;p>首先, 确保我们的窗口背景颜色为 &lt;code>Transparent&lt;/code>, 你的 XAML 代码应该像这样:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你的设置无误, 那么你的窗口现在的 &amp;ldquo;透明&amp;rdquo; 看起来应该是 &amp;ldquo;黑色&amp;rdquo;:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530134522.png"
loading="lazy"
>&lt;/p>
&lt;p>然后, 实现 &lt;code>HwndSource&lt;/code> 的 &lt;code>CompositionTarget&lt;/code> 设置和 &amp;ldquo;窗口框架&amp;rdquo;, 最简单的方式是直接为窗口设置 &lt;code>WindowChrome&lt;/code>, 通过对 &lt;code>WindowChrome&lt;/code> 类中名为 &lt;code>WindowChrome&lt;/code> 的附加属性进行赋值即可, 最后只需要设置 &lt;code>GlassFrameThickness&lt;/code> 为 -1 就完成了, 在 XAML 中这样编写:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome&lt;/span> &lt;span class="na">GlassFrameThickness=&lt;/span>&lt;span class="s">&amp;#34;-1&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>&lt;code>窗口边框拓展大小&lt;/code> 控制了窗口设置的模糊背景延伸到窗口内部的大小. 也就是说, 如果你将 &lt;code>GlassFrameThickness&lt;/code> 设置为 10, 那么窗口边缘的 10 像素会应用上指定的背景. 而 -1 在这里则表示无限大.&lt;/p>
&lt;/blockquote>
&lt;p>这样操作之后, &lt;code>WindowChrome&lt;/code> 会帮我们设置好所需的属性, 如果你的设置无误, 现在窗口应该会恢复到原来的 &amp;ldquo;白色&amp;rdquo;, 并且窗口的标题栏会 &amp;ldquo;消失&amp;rdquo;, 只留下三个窗口按钮:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530134637.png"
loading="lazy"
>&lt;/p>
&lt;p>最后, 我们订阅窗口的 &lt;code>SourceInitialized&lt;/code> 事件:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">SourceInitialized=&lt;/span>&lt;span class="s">&amp;#34;Window_SourceInitialized&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome&lt;/span> &lt;span class="na">GlassFrameThickness=&lt;/span>&lt;span class="s">&amp;#34;-1&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>并添加以下处理:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">unsafe&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Window_SourceInitialized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HwndSource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">PresentationSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromVisual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">backdropType&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 0 到 4 分别是 &amp;#39;自动&amp;#39;, &amp;#39;无&amp;#39;, &amp;#39;云母(Mica)效果&amp;#39;, &amp;#39;亚克力(Acrylic)效果&amp;#39;, &amp;#39;云母备选(Mica Alt)效果&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmSetWindowAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">SYSTEMBACKDROP_TYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">backdropType&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>注意, 在这里使用到了不安全代码块, 你需要在你的项目文件中启用 &amp;ldquo;允许不安全代码块&amp;rdquo; 才能使用此功能.&lt;/p>
&lt;/blockquote>
&lt;p>最后启动窗口, 操作无误的话, 你最终的窗口, 已经能够呈现出云母效果了.&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530135314.png"
loading="lazy"
>&lt;/p>
&lt;br />
&lt;h2 id="应用亚克力材质">应用亚克力材质&lt;/h2>
&lt;p>在上面, 我们已经成功将云母材质应用到了窗口上, 如果要换成亚克力效果, 也非常简单, 只需要将表示云母背景的 &amp;ldquo;2&amp;rdquo; 换成表示亚克力的 &amp;ldquo;3&amp;rdquo; 即可, 代码如下:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">unsafe&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Window_SourceInitialized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HwndSource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">PresentationSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromVisual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">backdropType&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 0 到 4 分别是 &amp;#39;自动&amp;#39;, &amp;#39;无&amp;#39;, &amp;#39;云母(Mica)效果&amp;#39;, &amp;#39;亚克力(Acrylic)效果&amp;#39;, &amp;#39;云母备选(Mica Alt)效果&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmSetWindowAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">SYSTEMBACKDROP_TYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">backdropType&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>那么, 最终的效果是这样, 可以看到窗口的背景是参考了其后方窗口内容的:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530140028.png"
loading="lazy"
>&lt;/p>
&lt;br />
&lt;h2 id="切换窗口亮暗色主题">切换窗口亮暗色主题&lt;/h2>
&lt;p>在 Windows11 的 22000 版本中, &lt;code>DwmSetWindowAttribute&lt;/code> 支持了表示窗口是否使用暗色模式的 &lt;code>DWMWA_USE_IMMERSIVE_DARK_MODE&lt;/code> 属性.&lt;/p>
&lt;p>当我们使用该 API 设置该属性为 1 的时候, 标题栏, 以及云母与亚克力材料会切换到对应的暗色. 下面, 我们向代码中添加将窗口设置为暗色模式的逻辑:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">unsafe&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Window_SourceInitialized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HwndSource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">PresentationSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromVisual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">backdropType&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 0 到 3 分别是 &amp;#39;自动&amp;#39;, &amp;#39;无&amp;#39;, &amp;#39;云母(Mica)效果&amp;#39;, &amp;#39;亚克力(Acrylic)效果&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">isDarkMode&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmSetWindowAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">SYSTEMBACKDROP_TYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">backdropType&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmSetWindowAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">USE_IMMERSIVE_DARK_MODE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">isDarkMode&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在我们的亚克力窗口背景看起来比以前暗了许多.&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530141132.png"
loading="lazy"
>&lt;/p>
&lt;p>如果它的背景更暗一些, 窗口看起来也会更暗:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530141233.png"
loading="lazy"
>&lt;/p>
&lt;p>我们再将亚克力材质换成云母, 它的暗色模式看起来是这样的, 因为它不参考窗口后的内容, 只参考壁纸, 所以无论窗口在哪, 它都是这副模样:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530141400.png"
loading="lazy"
>&lt;/p>
&lt;p>在调整窗口内容元素前景与背景色到大致合适的值之后, 它看起来是这样的:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530141807.png"
loading="lazy"
>&lt;/p>
&lt;br />
&lt;h2 id="自定义混合颜色亚克力">自定义混合颜色亚克力&lt;/h2>
&lt;p>在上面, 我们使用 &lt;code>DwmSetWindowAttribute&lt;/code> 实现了窗口的云母与亚克力背景, 而它们具体的颜色, 则是通过设置窗口是否是暗色实现来切换的. 如果我们需要自定义叠加的混合颜色, 那这个 API 就不能实现了.&lt;/p>
&lt;p>我们需要使用 &lt;code>SetWindowCompositionAttribute&lt;/code> 这个 API 来实现了. 当然, 在最开始我们也了解过这个 API 的弊端了, 所以, 除非你真的有这方面的需求, 否则尽量使用新的 API 比较好.&lt;/p>
&lt;p>同样, 在调用 API 之前, 需要确保我们的窗口设置了正确的属性, 第一个是背景颜色需要设为透明:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后, 需要确保 &amp;ldquo;窗口框架&amp;rdquo; 的拓展大小是 0, 也就是说, Window 必须不设置 &lt;code>WindowChrome&lt;/code>, 或者 &lt;code>WindowChrome&lt;/code> 的 &lt;code>GlassFrameThickness&lt;/code> 值需要为 0. 以下两种设置方式均可:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- 这里没有设置窗口的 WindowChrome --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者设置 &lt;code>WindowChrome&lt;/code>, 但是 &lt;code>GlassFrameThickness&lt;/code> 为 0:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome&lt;/span> &lt;span class="na">GlassFrameThickness=&lt;/span>&lt;span class="s">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后, 确保 &lt;code>HwndSource.CompositionTarget.BackgroundColor&lt;/code> 为透明, 最暴力的方式是直接将窗口的 &lt;code>AllowsTransparency&lt;/code> 设为 &lt;code>true&lt;/code>. 又因为只有 &lt;code>WindowStyle&lt;/code> 为 &lt;code>None&lt;/code> 是, 窗口才能设置 &lt;code>AllowsTransparency&lt;/code> 为 &lt;code>true&lt;/code>, 所以最终你的 XAML 像是这样:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">WindowStyle=&lt;/span>&lt;span class="s">&amp;#34;None&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">AllowsTransparency=&lt;/span>&lt;span class="s">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">SourceInitialized=&lt;/span>&lt;span class="s">&amp;#34;Window_SourceInitialized&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome&lt;/span> &lt;span class="na">GlassFrameThickness=&lt;/span>&lt;span class="s">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>就此, 我们的准备阶段完毕, 最后将 &lt;code>SourceInitialized&lt;/code> 事件处理逻辑更改为以下代码:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">unsafe&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Window_SourceInitialized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HwndSource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">PresentationSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromVisual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">accentPolicy&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AccentPolicy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AccentState&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">AccentState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">EnableAcrylicBlurBehind&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AccentFlags&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">AccentFlags&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">None&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 注意, 这里从高位到低位分别是 Alpha, Blue, Green, Red&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 每一个字节一个通道颜色值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">GradientColor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x338888FF&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">WindowCompositionAttributeData&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Attribute&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">WindowCompositionAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WcaAccentPolicy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DataPointer&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">accentPolicy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DataSize&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">uint&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AccentPolicy&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SetWindowCompositionAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行后, 它的效果是偏红色的亚克力窗口.&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530144501.png"
loading="lazy"
alt="Pasted image 20240530144501"
>&lt;/p>
&lt;p>相信你也一定发现了一些问题, 经过一番设置之后, 我们的窗口:&lt;/p>
&lt;ul>
&lt;li>由于设置了 &lt;code>AllowsTransparency&lt;/code> 为 &lt;code>True&lt;/code>, 窗口中的 &amp;ldquo;透明&amp;rdquo; 部分, 鼠标事件会穿透它, 从而点击到窗体后方的内容.&lt;/li>
&lt;li>由于设置了 &lt;code>WindowStyle&lt;/code> 为 &lt;code>None&lt;/code>, 窗口标题栏没有了, 按钮没有了, 圆角没有了, 最小化最大化与关闭的动画没有了.&lt;/li>
&lt;/ul>
&lt;p>关于第一点, 可以通过一种简单暴力的方式来解决, 只需要给窗口的不透明度一个很小的值, 即可:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;#01000000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">WindowStyle=&lt;/span>&lt;span class="s">&amp;#34;None&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">AllowsTransparency=&lt;/span>&lt;span class="s">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">SourceInitialized=&lt;/span>&lt;span class="s">&amp;#34;Window_SourceInitialized&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;WindowChrome&lt;/span> &lt;span class="na">GlassFrameThickness=&lt;/span>&lt;span class="s">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/WindowChrome.WindowChrome&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>而第二点, 本质上是因为我们通过设置 &lt;code>WindowStyle&lt;/code> 以满足调用条件导致的, 只需要我们不去设置 &lt;code>WindowStyle&lt;/code>, 从底层上自己满足调用条件, 就可以解决. 具体的操作方式, 请继续往下看.&lt;/p>
&lt;br />
&lt;h2 id="从底层上满足调用条件">从底层上满足调用条件&lt;/h2>
&lt;p>在上面的代码中, 为了满足 &lt;code>DwmSetWindowAttribute&lt;/code> 和 &lt;code>SetWindowCompositionAttribute&lt;/code> 的调用条件, 我们使用了 &lt;code>WindowChrome.WindowChrome&lt;/code>, &lt;code>WindowStyle&lt;/code>, &lt;code>AllowsTransparency&lt;/code> 属性. 而它们也都有自己的副作用:&lt;/p>
&lt;ul>
&lt;li>&lt;code>WindowChrome&lt;/code> 会去除窗口自带的标题栏, 你还需要手动用 WPF 自己做一个标题栏&lt;/li>
&lt;li>&lt;code>WindowStyle&lt;/code> 设为 &lt;code>None&lt;/code> 会导致窗口的边框消失, 窗口操作按钮消失, 动画消失, 圆角消失.&lt;/li>
&lt;li>&lt;code>AllowsTransparency&lt;/code> 设为 &lt;code>True&lt;/code> 会导致透明部分穿透鼠标事件&lt;/li>
&lt;/ul>
&lt;p>实际上, 最终我们需要满足的条件也只有:&lt;/p>
&lt;ul>
&lt;li>窗口的背景设为透明, 以能够查看到设置的窗口背景样式&lt;/li>
&lt;li>&lt;code>HwndSource.CompositionTarget.BackgroundColor&lt;/code> 设为透明&lt;/li>
&lt;li>当使用 &lt;code>DwmSetWindowAttribute&lt;/code> 时, &amp;ldquo;窗口框架&amp;rdquo; 的拓展厚度设置到一个足够大的值, 当使用 &lt;code>SetWindowCompositionAttribute&lt;/code> 时, &amp;ldquo;窗口框架&amp;rdquo; 的拓展厚度需要设置为 0&lt;/li>
&lt;/ul>
&lt;p>那么现在, 我们将多余的属性删去, 仅保留窗体的以下属性:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;Window&lt;/span> &lt;span class="err">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">Background=&lt;/span>&lt;span class="s">&amp;#34;Transparent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">SourceInitialized=&lt;/span>&lt;span class="s">&amp;#34;Window_SourceInitialized&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/Window&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后在 &lt;code>SourceInitialized&lt;/code> 改为以下逻辑, 来实现手动满足条件的云母效果:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">unsafe&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Window_SourceInitialized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 取得窗口句柄&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HwndSource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">PresentationSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromVisual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 设置 HwndSource.CompositionTarget.BackgroundColor 为透明&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">CompositionTarget&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">BackgroundColor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Colors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Transparent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 设置边框&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">margins&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Margins&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LeftWidth&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TopHeight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RightWidth&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BottomHeight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmExtendFrameIntoClientArea&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="n">margins&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 设置背景&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">backdrop&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmSetWindowAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DwmWindowAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">SYSTEMBACKDROP_TYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">backdrop&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后我们就得到了一个, 带有窗口正常标题栏与云母背景的窗口:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530152406.png"
loading="lazy"
>&lt;/p>
&lt;p>同理, 我们手动处理 &lt;code>SetWindowCompositionAttribute&lt;/code> 的调用条件, XAML 不需要更改, 只需要将逻辑改为下面的代码:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">unsafe&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Window_SourceInitialized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 取得窗口句柄&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HwndSource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">PresentationSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromVisual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 设置 HwndSource.CompositionTarget.BackgroundColor 为透明&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">CompositionTarget&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">BackgroundColor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Colors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Transparent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 设置边框&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">margins&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Margins&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LeftWidth&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TopHeight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RightWidth&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BottomHeight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DwmExtendFrameIntoClientArea&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="n">margins&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 设置背景&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">accentPolicy&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AccentPolicy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AccentState&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">AccentState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">EnableAcrylicBlurBehind&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AccentFlags&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">AccentFlags&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">None&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 注意, 这里从高位到低位分别是 Alpha, Blue, Green, Red&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 每一个字节一个通道颜色值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">GradientColor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0x338888FF&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">WindowCompositionAttributeData&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Attribute&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">WindowCompositionAttribute&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WcaAccentPolicy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DataPointer&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nint&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">void&lt;/span>&lt;span class="p">*)&amp;amp;&lt;/span>&lt;span class="n">accentPolicy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DataSize&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">uint&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AccentPolicy&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SetWindowCompositionAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>于是我们得到了一个带有不透明标题栏与自定义混合颜色亚克力背景的窗口:&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530152815.png"
loading="lazy"
>&lt;/p>
&lt;br />
&lt;h2 id="错误参考">错误参考&lt;/h2>
&lt;p>下面是一些属性没有正确设置会导致的结果:&lt;/p>
&lt;p>窗口颜色过曝, 没有将 &lt;code>HwndSource.CompositionTarget.BackgroundColor&lt;/code> 设置为透明导致.&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530153159.png"
loading="lazy"
>&lt;/p>
&lt;p>窗口黑了, &amp;ldquo;窗口边框&amp;rdquo; 拓展大小于 API 所需大小不匹配导致.&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240530153317.png"
loading="lazy"
>&lt;/p>
&lt;br />
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>可以使用 &lt;code>DwmSetWindowAttribute&lt;/code> 与 &lt;code>SetWindowCompositionAttribute&lt;/code> 设置窗口的背景, 其中前者只能用于 Windows11 上设置亮暗的云母与亚克力材质, 后者能够设置自定义混合颜色的亚克力材质. 前者能够将材质应用到标题栏与内容, 而后者只能将材料应用到内容中.&lt;/p>
&lt;p>这两个 API 均有自己的 &amp;ldquo;条件&amp;rdquo;, 只有条件满足, 所指定的背景才能够被用户看到. 否则要么无作用, 要么窗口的内容变得很奇怪.&lt;/p>
&lt;p>使用 &lt;code>WindowChrome&lt;/code>, &lt;code>WindowStyle&lt;/code> 与 &lt;code>AllowsTransparency&lt;/code> 的根本目的是满足显示指定背景, 我们完全可以自己完整这一操作. 这样就不需要承担那三个属性会导致的副作用.&lt;/p>
&lt;br />
&lt;h2 id="引用">引用&lt;/h2>
&lt;p>文章参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.cnblogs.com/TwilightLemon/p/17479921.html" target="_blank" rel="noopener"
>WPF在win10/11上启用模糊特效 适配Dark/Light Mode - TwilightLemon)&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.walterlv.com/post/win10/2017/10/02/wpf-transparent-blur-in-windows-10.html" target="_blank" rel="noopener"
>在 Windows 10 上为 WPF 窗口添加模糊特效（就像开始菜单和操作中心那样） - walterlv&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.walterlv.com/post/using-acrylic-in-wpf-application.html" target="_blank" rel="noopener"
>在 WPF 程序中应用 Windows 10 真•亚克力效果 - walterlv&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.walterlv.com/post/set-window-composition-attribute" target="_blank" rel="noopener"
>使用 SetWindowCompositionAttribute 来控制程序的窗口边框和背景（可以做 Acrylic 亚克力效果、模糊效果、主题色效果等） - walterlv&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>代码参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/TwilightLemon/MyToolBar" target="_blank" rel="noopener"
>TwilightLemon/MyToolBar: 为Surface Pro而生的顶部工具栏 支持触控和笔快捷方式 (github.com)&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/sourcechord/FluentWPF" target="_blank" rel="noopener"
>sourcechord/FluentWPF: Fluent Design System for WPF. (github.com)&lt;/a>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>注: 上面提到的文章参考可能只介绍到了 &amp;ldquo;某一部分&amp;rdquo; 内容, 可能会造成误导, 注意看完本篇文章后自行验证&lt;/p>
&lt;/blockquote></description></item><item><title>[WPF] EleCho.WpfSuite, 控件, 布局容器, 过渡动画, 标记拓展以及实用工具</title><link>https://slimenull.com/p/20240523162351/</link><pubDate>Thu, 23 May 2024 16:23:51 +0800</pubDate><guid>https://slimenull.com/p/20240523162351/</guid><description>&lt;p>相信各位朋友在搞 WPF 开发的时候，不可避免的会重复的写到很多重复的代码，以给WPF擦屁股。例如WPF中没有CornerRadiusAnimation，没有支持自定义的贝塞尔曲线过渡函数，内置的值转换器太少，控件无法设置圆角，容器不能直接通过自己的属性设置元素间距等诸多问题。&lt;/p>
&lt;p>于是，我写了个库，用于补全我认为 WPF 中应该有，但是缺失了的一些功能。&lt;/p>
&lt;h2 id="elechowpfsuite">EleCho.WpfSuite&lt;/h2>
&lt;p>WPF 布局面板，控件，值转换器，标记拓展，过渡以及实用工具。&lt;/p>
&lt;blockquote>
&lt;p>你可以在 Releases 中下载 SampleApp 看看这个库大概是什么样子的。
&lt;a class="link" href="https://github.com/OrgEleCho/EleCho.WpfSuite/releases" target="_blank" rel="noopener"
>https://github.com/OrgEleCho/EleCho.WpfSuite/releases&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;br/>
&lt;h3 id="安装与使用">安装与使用&lt;/h3>
&lt;p>在 nuget 中直接安装 EleCho.WpfSuite 即可。命名空间声明如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">xmlns:ws=&amp;#34;https://github.com/OrgEleCho/EleCho.WpfSuite&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>库的所有功能均在这个命名空间下。&lt;/p>
&lt;br/>
&lt;h3 id="布局面板">布局面板&lt;/h3>
&lt;p>WpfSuite 中重写了 StackPanel 以及 WrapPanel，它们现在均支持使用 “Spacing” 属性来直接调整元素之间的间距，而不需要手动设置元素 Margin。WrapPanel 的间距是允许自定义水平以及垂直两个方向上的。&lt;/p>
&lt;p>除此之外，WpfSuite 还提供了 FlexPanel（弹性面板），MasonryPanel（瀑布流面板）这两个布局容器。其中 FlexPanel 基本支持 CSS 中 flex 布局的所有功能，包括 Grow，Shrink 以及各种对齐。MasonryPanel 则是很直观的瀑布流布局，和 StackPanel 一样，你可以指定该容器的方向。而且这些布局控件都是支持使用 “Spacing” 属性来直接指定元素间距的。&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523162903.png"
loading="lazy"
>&lt;/p>
&lt;br/>
&lt;h3 id="控件">控件&lt;/h3>
&lt;p>WpfSuite 重写了大部分常用 WPF 控件，为它们直接添加了 CornerRadius 属性，以及其他关于控件状态的相关属性，例如 “DisabledBackground” 属性，当为其制定值时，如果控件被禁用，那么控件的背景颜色就会切换到设置的颜色。其他的状态还包含 Hover，Pressed，Selected，Selected Inactive，这样我们不需要更改控件的模板，就能直接更改它在不同状态下的颜色，边框。&lt;/p>
&lt;p>很多时候我们会遇到 “控件” 的内容超出带圆角的 “Border” 范围的情况，我们希望控件的内容被裁剪到 Border 内部，现在这个需求可以非常简单的实现。WpfSuite 重写了 Border 的实现，并提供了一个 “ContentClip” 属性，只需要把 Border 的内容的 Clip 属性绑定到 Border 的 ContentClip 上，就可以完成自动裁剪了！&lt;/p>
&lt;p>而且，所有 WpfSuite 提供的控件均不影响原有 WPF 控件，它不会对原有 WPF 控件做任何更改，所以如果你担心某些控件的拓展功能会造成性能问题，你也可以完全不使用它。&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523162925.png"
loading="lazy"
>&lt;/p>
&lt;br/>
&lt;h3 id="值转换器">值转换器&lt;/h3>
&lt;p>WpfSuite 还提供了常用的诸多值转换器，例如用于将任意对象值判空并返回 bool 的转换器，将数字与指定数字做对比并返回 bool 的转换器，做一些简单的数学计算并返回结果的 bool 转换器，以及能够将值转换器串起来的 “值转换器组”。&lt;/p>
&lt;p>它们能够做的东西当然超级多，例如，如果你有一个属性是集合类型的，那么你完全可以将界面上某元素的 Visibility 绑定到这个属性的 Count 属性上，然后指定转换器为 “数字非0判断” 以及 Bool 转 Visibility 组合成的一个 ValueConverterGroup，于是，这个控件就仅在集合不为空的时候会显示出来了！这很 MVVM，这很酷！&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;ws:ValueConverterGroup&lt;/span> &lt;span class="na">x:Key=&lt;/span>&lt;span class="s">&amp;#34;CollectionIsNotEmptyToVisibilityConverter&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;ws:CollectionIsNotNullOrEmptyConverter/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;ws:BooleanToVisibilityConverter/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/ws:ValueConverterGroup&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523162944.png"
loading="lazy"
>&lt;/p>
&lt;br/>
&lt;h3 id="标记拓展">标记拓展&lt;/h3>
&lt;p>标记拓展应该是 WpfSuite 最简单的部分了，它只是提供了 MarkupExtension 以让你能在 XAML 中直接写出来表示具体类型的值。&lt;/p>
&lt;p>例如，你有一个控件，该控件有一个属性是 Object 类型的，你希望往里面传入一个长整型，如果你在 XAML 中直接写 “114514” 这样的数字，它肯定不会帮你转成你想要的类型并传入的，它会把你的字符串原封不动的传过去… 这个时候，标记拓展就派上用场了！你直接使用 {ws:Int64 114514} 就能直接表示一个精确的长整型的值。&lt;/p>
&lt;p>还有一些使用场景，就是 DataTrigger，例如你希望你的某些数据触发器，当数据等于某个确切值得时候触发，但很遗憾， DataTrigger 的 Value 属性正好是 Object 类型的，而有些时候它并不能识别到你这个数据的类型，也当然没办法对你在 XAML 中写的字符串做正确的转型，这个时候用能够制定确切类型的标记拓展再合适不过了。&lt;/p>
&lt;br/>
&lt;h3 id="过渡">过渡&lt;/h3>
&lt;p>过渡在应用程序中用的应该是特别多的，我们很难想象，WPF 提供了完整的动画系统，但是居然没有提供封装好的过渡动画！&lt;/p>
&lt;p>有时候，我们希望某个内容被更改的时候，它能够执行一些动画，例如淡入淡出，划出划入，或者是缩放，甚至旋转，或把这些结合起来之类的，这个时候，WpfSuite 提供的 TransitioningContentControl 能够轻松的帮你解决这个问题！&lt;/p>
&lt;blockquote>
&lt;p>熟悉 Avalonia 的朋友肯定要说了，这不就 Avalonia 自带的东西嘛！没错！我就是看到 Avalonia 有这东西，但是 WPF 没有，然后我眼红，就移植过来了！&lt;/p>
&lt;/blockquote>
&lt;p>对 TransitioningContentControl 指定你想要的过渡效果，它就可以在内容变更时自动执行这个效果。内置的有 Slide（滑动），Fade（淡入淡出），Scale（缩放）以及结合 Slide 和 Fade 的 SlideFade（滑动的同时，淡入淡出）。&lt;/p>
&lt;p>而且我们对 Frame 控件也支持了过渡动画，又因为动画也是有正向与反向之分的，所以当你使用 Frame 的 ”GoBack“ 方法时，动画的执行也是反向的。&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523164142.png"
loading="lazy"
>&lt;/p>
&lt;p>同时，你也可以手动将动画的 Reverse 设为 true，这样它的方向就被置换了。最经典的一个应用就是，左侧导航项与右侧带滑动动画的 Frame，当点击当前项后面的项时，正向执行动画，当点击当前项前面的项时，反向执行动画，这样你就做到了一个非常不错的页面滑动效果！&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523164633.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523164706.png"
loading="lazy"
>&lt;/p>
&lt;p>除此之外，你也可以用它来做 Banner 图像的切换动画，例如用户点击按钮的时候，更换图片，而图片由 TransitioningContentControl 容纳，所以也可与用它来做这个动画，点击左边的按钮则从左方滑入新图片，点击右边的按钮则从右方滑入新图片，听起来就很不错。&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523181634.png"
loading="lazy"
>&lt;/p>
&lt;br/>
&lt;h3 id="实用工具">实用工具&lt;/h3>
&lt;p>在这部分中，最有用的就属绑定代理了。举个例子，我需要做一个列表项的右键菜单，并且菜单使用 MVVM，也就是说，逻辑使用指令实现，参数通过绑定传入。但是右键菜单的可视化树和列表不是同一个，你在 Menu 上使用 Binding 会因为找不到 DataContext 而失败。&lt;/p>
&lt;p>使用绑定代理则可以轻松解决这个问题。因为静态资源是正常使用的，所以你只需要把绑定代理作为静态资源定义在窗口中，并指定 Data=&amp;quot;{Binding}&amp;quot;，然后在你的 Menu 中把 Binding 的 DataSource 指定为刚刚定义的静态资源，就能够成功在菜单中引用到正常的 DataContext 了。&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/Pasted%20image%2020240523163503.png"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>该方案适用于任何因 VisualTree 而导致 DataContext 找不到，进而导致绑定失败的所有问题。&lt;/p>
&lt;/blockquote>
&lt;p>除此之外，还有一些小工具，例如 ValidationUtils，用于自定义依赖属性的属性验证，或者 ColorUtils，用于计算 HSV 与 RGB 的转换。&lt;/p></description></item><item><title>[.NET] WPF 数据绑定与 MVVM 模型</title><link>https://slimenull.com/p/20230902090054/</link><pubDate>Sat, 02 Sep 2023 09:00:54 +0800</pubDate><guid>https://slimenull.com/p/20230902090054/</guid><description>&lt;p>欸? 你还在使用 Dispatcher 来设置与获取数据? 落后啦! 快来试试 MVVM 吧!&lt;/p>
&lt;h2 id="数据绑定">数据绑定:&lt;/h2>
&lt;p>数据绑定需要有一个源, 这个源可以是一个控件, 也可以是一个对象.&lt;/p>
&lt;p>最简单的数据绑定是对控件属性的绑定. 例如, 一个 Label 始终显示 Slider 的值:
&lt;img src="https://slimenull.com/images/20210216034234250.png"
loading="lazy"
>
&lt;img src="https://slimenull.com/images/4qFhAxjnDcHfmOv.gif"
loading="lazy"
>
绑定数据到某个控件, 此时, 数据绑定的源就是这个控件. Path是Value, 即, 我们要获取与设置这个控件的Value&lt;/p>
&lt;h2 id="datacontext">DataContext:&lt;/h2>
&lt;p>如果要设置源为一个对象. 例如我们定义的 MyObj 的实例, 则需要指定 DataContext. 指定 DataContext 的控件以及它的子元素都将使用指定的对象作为数据绑定的源. 例如:
&lt;img src="https://slimenull.com/images/2021021604063641.png"
loading="lazy"
>
&lt;img src="https://slimenull.com/images/20210216040836373.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="mvvm">MVVM:&lt;/h2>
&lt;p>MVVM 的意思是: Model, View, ViewModel, 其中:&lt;/p>
&lt;ul>
&lt;li>Model: 程序的核心代码, 例如数据库操作&lt;/li>
&lt;li>View: 程序的展示层, 例如 UI 展示与 UI 事件.&lt;/li>
&lt;li>ViewModel: 视图数据层.&lt;/li>
&lt;/ul>
&lt;p>啊我知道你很迷惑&amp;hellip; 毕竟当时我也是这样, 反正, 一个例子足够描述出来了.&lt;/p>
&lt;h2 id="例子">例子:&lt;/h2>
&lt;ol>
&lt;li>新建一个 WPF 项目. 此次演示, 我们以 MvvmTest 作为项目名.&lt;/li>
&lt;li>在项目中创建以下文件夹: Model, View, ViewModel.&lt;/li>
&lt;li>将 MainWindow.xaml 移动到 View 中. 并调整 xaml 中的 Window 的 x:Class 属性值.&lt;/li>
&lt;/ol></description></item><item><title>[Win32] 在不创建窗口的情况下接收处理消息.</title><link>https://slimenull.com/p/20230328075624/</link><pubDate>Tue, 28 Mar 2023 07:56:24 +0800</pubDate><guid>https://slimenull.com/p/20230328075624/</guid><description>&lt;p>如果你在使用一个控制台程序, 并且还希望处理一些全局快捷键, 那么这个方法是合适的.&lt;/p>
&lt;blockquote>
&lt;p>这里说的不创建窗口指的是不创建可见的窗口&lt;/p>
&lt;/blockquote>
&lt;h2 id="使用-messageonly-窗口">使用 MessageOnly 窗口&lt;/h2>
&lt;p>Windows 中存在一个特殊的窗体句柄 HWND_MESSAGE, 它的值是 -3, 当一个窗口的父窗口是它的时候, 这个窗口会成为 &amp;ldquo;仅消息窗口&amp;rdquo;&lt;/p>
&lt;p>使用仅消息窗口可以发送和接收消息。 它不可见、没有 z 顺序、无法枚举且不接收广播消息。 该窗口只是调度消息。&lt;/p>
&lt;p>若要创建仅消息窗口，请在 &lt;a class="link" href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-createwindowexa" target="_blank" rel="noopener"
>CreateWindowEx&lt;/a> 函数的 hWndParent 参数中指定HWND_MESSAGE常量或现有仅消息窗口的句柄。 还可以通过在 SetParent 函数的 hWndNewParent 参数中指定HWND_MESSAGE，将现有窗口更改为仅消息窗口。&lt;/p>
&lt;blockquote>
&lt;p>参考: &lt;a class="link" href="https://learn.microsoft.com/zh-cn/windows/win32/winmsg/window-features#message-only-windows" target="_blank" rel="noopener"
>窗口功能:仅消息窗口 -Win32 apps | Microsoft Learn&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="wpf-的使用示例">WPF 的使用示例:&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 窗口创建的参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">HwndSourceParameters&lt;/span> &lt;span class="n">hwndSourceParameters&lt;/span> &lt;span class="p">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">HwndSourceParameters&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HwndSourceHook&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Hook&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ParentWindow&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">IntPtr&lt;/span>&lt;span class="p">)(-&lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1">// a magic window handle&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 创建窗口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">hwndSource&lt;/span> &lt;span class="p">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">HwndSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hwndSourceParameters&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Hook 消息方法定义&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">IntPtr&lt;/span> &lt;span class="n">Hook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IntPtr&lt;/span> &lt;span class="n">hwnd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">wParam&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">lParam&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">ref&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="n">handled&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 这里处理消息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>[安利] 什么鬼? 居然还有人不会截图??? 还在用手机对着电脑屏幕拍照????? 各种截图方式大集结!</title><link>https://slimenull.com/p/20210227214017/</link><pubDate>Sat, 27 Feb 2021 21:40:17 +0800</pubDate><guid>https://slimenull.com/p/20210227214017/</guid><description>&lt;p>&lt;img src="https://slimenull.com/images/20210220202627560.png"
loading="lazy"
>
某天, 我在一群里看到了这副画面&amp;hellip; 我的天哪!!! 他居然!!! 还在用手机拍照! 简直妄为技术人! 得, 我今天就全方面得介绍一波你在电脑中可以进行截图的方式吧!&lt;/p>
&lt;h2 id="截图方式">截图方式:&lt;/h2>
&lt;p>首先啊, 截图还是有不同的存储方式的, 像是手机里, 一般都是保存为文件, 电脑上当然也支持这种方式, 当然最最最好用的! 还是截图到剪切板. (不知道剪切板的可以重开人生以谢罪了)&lt;/p>
&lt;p>而这种方式保存的图呢, 一般用于粘贴出来. 例如 QQ 微信 的消息输入框, 你可以直接粘贴位于剪切板中的内容. 像是PS, Word, MSPaint(画图), 这些程序也是支持粘贴图片的! 当然当然, CSDN 的 Markdown 编辑器也是支持粘贴图片的, 自动上传图片到 CSDN, 挺好用的哈哈.&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/20210220203834456.png"
loading="lazy"
alt="QQ输入框粘贴图片"
>&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/20210220203909645.png"
loading="lazy"
alt="画图中粘贴图片"
>&lt;/p>
&lt;h2 id="通用截图">通用截图:&lt;/h2>
&lt;h5 id="prtsc-以及与之相关的截图快捷键">PrtSc 以及与之相关的截图快捷键:&lt;/h5>
&lt;p>各个系统! 通用的截图快捷键!!! PrtSc 键! 全称是 Print Screen, 按下它的作用是, 将整块屏幕的内容截取, 然后存储在剪切板中. 还有 Alt + PrtSc, 它是将当前的活动窗口的内容截取, 存储到剪切板.&lt;/p>
&lt;p>例如这样, 就是截取整个屏幕的&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/20210220204007362.png"
loading="lazy"
alt="截取全屏"
>
这样, 就是截取当前活动窗口的, 因为我现在正在使用浏览器, 所以就是浏览器的内容, 不包括底部任务栏:
&lt;img src="https://slimenull.com/images/20210220204118422.png"
loading="lazy"
alt="截取活动窗口"
>&lt;/p>
&lt;h2 id="windows-截图工具">Windows 截图工具:&lt;/h2>
&lt;ul>
&lt;li>估计早就没人用了, 建议跳过.&lt;/li>
&lt;/ul>
&lt;h4 id="1-snippingtool-windows-自带的截图工具-中文名-截图工具">1. SnippingTool: Windows 自带的截图工具. 中文名: 截图工具.&lt;/h4>
&lt;h5 id="简述">简述:&lt;/h5>
&lt;ul>
&lt;li>Snipping Tool 是一个很老的工具了, 至少在 XP 就已经存在, 并且, 虽然在 Win10 已经有了更好的截图方式, 不过这个工具还是保留了下来.&lt;/li>
&lt;/ul>
&lt;h5 id="效果图">效果图:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/20210220204808135.png"
loading="lazy"
>&lt;/p>
&lt;h5 id="使用方式">使用方式:&lt;/h5>
&lt;ol>
&lt;li>Windows 全局搜索:
&lt;img src="https://slimenull.com/images/20210220204631303.png"
loading="lazy"
alt="搜索Snipping Tool"
>&lt;/li>
&lt;li>运行:&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://slimenull.com/images/20210220204708154.png"
loading="lazy"
alt="运行SnippingTool"
>&lt;/p>
&lt;h5 id="支持功能">支持功能:&lt;/h5>
&lt;ol>
&lt;li>矩形截屏:
在屏幕上拖拽出一个矩形, 并将举行包含的内容保存到剪切板.
&lt;img src="https://slimenull.com/images/20210220213247402.gif"
loading="lazy"
alt="SnippingTool矩形截屏"
>&lt;/li>
&lt;li>自由截屏:
随便画出一个形状, 然后将形状包含的内容保存到剪切板. &lt;img src="https://slimenull.com/images/20210220213737697.gif"
loading="lazy"
alt="SnippingTool自由截屏演示"
>&lt;/li>
&lt;li>窗口截屏:
选择一个窗口, 然后将窗口的内容保存到剪切板.
&lt;img src="https://slimenull.com/images/20210221233659634.gif"
loading="lazy"
alt="SnippingTool窗口截屏"
>&lt;/li>
&lt;li>截屏编辑:
截屏成功后, 会直接进入编辑页面. 并且还支持保存为 JPG, PNG, MHT 文件格式.
&lt;img src="https://slimenull.com/images/20210221235614159.png"
loading="lazy"
>&lt;/li>
&lt;/ol>
&lt;h2 id="win10-截图快捷键">Win10 截图快捷键:&lt;/h2>
&lt;ul>
&lt;li>估计不是很多人会用这个.&lt;/li>
&lt;/ul>
&lt;h4 id="1-win--shift--s">1. Win + Shift + S&lt;/h4>
&lt;h5 id="简述-1">简述:&lt;/h5>
&lt;ul>
&lt;li>是 Windows10 新增的截图快捷键, 截图后直接存储到剪切板, 并且可以在通知栏对图像进行更多操作.&lt;/li>
&lt;/ul>
&lt;h5 id="效果图-1">效果图:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/2021022123122610.gif"
loading="lazy"
alt="Win10截屏演示"
>&lt;/p>
&lt;h5 id="支持功能-1">支持功能:&lt;/h5>
&lt;ol>
&lt;li>
&lt;p>矩形截屏:
拖拽一个矩形, 然后截取矩形内的内容保存到剪切板.
&lt;img src="https://slimenull.com/images/20210221231332921.gif"
loading="lazy"
alt="Win10矩形截屏"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>自由截屏:
自由选择一个区域, 然后保存到剪切板.
&lt;img src="https://slimenull.com/images/20210221234430996.gif"
loading="lazy"
alt="Win10自由截屏"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>窗口截屏:
选择窗口截屏, 保存到剪切板.
&lt;img src="https://slimenull.com/images/2021022123482916.gif"
loading="lazy"
alt="Win10窗口截屏"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>截取全屏:
点击, 即截取全屏并保存到剪切板.
&lt;img src="https://slimenull.com/images/20210221235020564.gif"
loading="lazy"
alt="Win10截取全屏"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>截屏编辑:
截屏成功的项目(Item), 可以在通知中查看, 点击, 即进入对该图的编辑.
&lt;img src="https://slimenull.com/images/20210221235249178.gif"
loading="lazy"
alt="Win10截屏编辑"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="qq--微信">QQ &amp;amp; 微信:&lt;/h2>
&lt;ul>
&lt;li>不用说, 肯定有人不知道 QQ 和微信还有截图功能!&lt;/li>
&lt;/ul>
&lt;h4 id="1-qq-ctrl--alt--a">1. QQ: Ctrl + Alt + A:&lt;/h4>
&lt;h5 id="简述-2">简述:&lt;/h5>
&lt;ul>
&lt;li>QQ 的默认截屏快捷键是 Ctrl + Alt + A, 温馨提示, QQ 的截屏功能非常强大, 是前面两个方式无法比拟的.&lt;/li>
&lt;/ul>
&lt;h5 id="效果图-2">效果图:&lt;/h5>
&lt;p>按 Ctrl + Alt + A 进入截图,
&lt;img src="https://slimenull.com/images/2021022200001067.gif"
loading="lazy"
alt="QQ截图"
>&lt;/p>
&lt;h5 id="支持功能-2">支持功能:&lt;/h5>
&lt;ol>
&lt;li>
&lt;p>矩形截屏:
正如刚刚演示的, 直接拖拽即可截取矩形区域, 并存储到剪切板. &lt;img src="https://slimenull.com/images/2021022200001067.gif"
loading="lazy"
alt="QQ截图"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>置顶贴纸:
截取一个区域后, 先不要确认, 点击一个钉子图标, 即可将截取的区域置顶悬浮, 并且可拖拽. 双击可关闭.
&lt;img src="https://slimenull.com/images/20210222000602186.gif"
loading="lazy"
alt="QQ截图贴纸功能"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>文本识别与翻译功能:
选择完一个区域后, 还支持文本识别和翻译功能.&lt;img src="https://slimenull.com/images/20210222001305999.gif"
loading="lazy"
alt="QQ文本识别与翻译"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>编辑功能:
选择完矩形区域, 进入编辑模式, 下面有非常多的选项可供使用. 从左到右, 依次是这些:
&lt;img src="https://slimenull.com/images/20210222001035814.png"
loading="lazy"
alt="QQ截图编辑功能"
>
&lt;img src="https://slimenull.com/images/2021022200184782.png"
loading="lazy"
alt="QQ截图编辑功能"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="2-微信-alt--a">2. 微信: Alt + A:&lt;/h4>
&lt;h5 id="简述-3">简述:&lt;/h5>
&lt;ul>
&lt;li>微信的默认截屏键是 Alt + A, 不过微信的截屏相比 QQ 来讲, 就弱很多了, 没多少功能, 没有置顶贴纸功能.&lt;/li>
&lt;/ul>
&lt;h5 id="效果图-3">效果图:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/20210222002258815.gif"
loading="lazy"
alt="微信截图"
>&lt;/p>
&lt;h5 id="支持功能-3">支持功能:&lt;/h5>
&lt;ol>
&lt;li>矩形截屏:
跟 QQ 一模一样, 就不放图了&lt;/li>
&lt;li>编辑功能:
弱化版的 QQ 截图编辑, 只有形状, 箭头, 马赛克, 文本识别, 别的都没有.&lt;/li>
&lt;/ol>
&lt;h2 id="第三方工具">第三方工具:&lt;/h2>
&lt;p>好了! 重点来了! QQ 的截图是强大了, 但是有的时候你不联网, 没办法登陆 QQ, 可不是就不能用 QQ 的截图了?&lt;/p>
&lt;h4 id="1-snipaste">1. Snipaste:&lt;/h4>
&lt;h5 id="简述-4">简述:&lt;/h5>
&lt;ul>
&lt;li>官方网站: &lt;a class="link" href="https://www.snipaste.com/" target="_blank" rel="noopener"
>www.snipaste.com&lt;/a>&lt;/li>
&lt;li>一个非常强大的截图工具! 完全能够替代 QQ, 相比较 QQ, 它没有文本识别和长截图功能. 但是它可以作为一个非常好用的取色器(虽然 QQ 也彳亍, 但是 Snipaste 更好用)&lt;/li>
&lt;li>在各个工具上, 比 QQ 要细致更多! 例如 Snipaste 的有模糊工具和马赛克工具这两种, 并且可以调整模糊程度; 矩形工具和椭圆工具中, Snipaste 可以还放置实心的形状, 而 QQ 仅仅支持单线边框的形状.&lt;/li>
&lt;li>支持截图时微调, 通过 WSAD 按键, 可以一个像素一个像素的移动鼠标光标, 通过箭头, 可以移动整个选框的位置, 也是逐像素.&lt;/li>
&lt;li>更方便的快捷键, Snipaste 支持通过快捷键来将最后一个截取的图片作为置顶贴纸放置出来, 这是 QQ 所不支持的.&lt;/li>
&lt;li>更厉害的贴纸, 如果你复制了一个十六进制颜色代码, RGB颜色码, 一段文本, 或者是 Excel 表格中的内容, 这时你将它贴在屏幕上, Snipaste 会为你展示所有你需要的信息.&lt;/li>
&lt;li>支持多种语言, 自动适配系统区域设置.&lt;/li>
&lt;/ul>
&lt;h5 id="效果图-4">效果图:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/20210222002916433.gif"
loading="lazy"
alt="Snipaste截图"
>&lt;/p>
&lt;h5 id="支持功能-4">支持功能:&lt;/h5>
&lt;ol>
&lt;li>矩形截屏:
Snipaste 的默认截屏快捷键是 F1, 使用方式上与 QQ 的截屏没有太大的差异.
&lt;img src="https://slimenull.com/images/20210222002916433.gif"
loading="lazy"
alt="Snipaste截图"
>&lt;/li>
&lt;li>置顶贴纸:
当你截屏完毕后, 可以直接通过 F3 来将这个图像贴在屏幕上, 同样可移动, 并且还支持鼠标滚轮调整大小. 双击可关闭.
&lt;img src="https://slimenull.com/images/20210222003947421.gif"
loading="lazy"
alt="Snipaste贴纸"
>&lt;/li>
&lt;li>更细致的贴纸:
对于文本, 颜色值, 表格内容, 贴纸都有进行处理. 非常完美的格式化!
&lt;img src="https://slimenull.com/images/20210222005024642.gif"
loading="lazy"
alt="Snipaste对文本的处理"
>
&lt;img src="https://slimenull.com/images/202102220042467.gif"
loading="lazy"
alt="Snipaste对颜色的贴纸处理"
>
&lt;img src="https://slimenull.com/images/20210222004616265.gif"
loading="lazy"
alt="Snipaste对表格的贴纸处理"
>&lt;/li>
&lt;li>显示/隐藏 所有贴纸:
Snipaste 还支持临时隐藏所有的贴纸, 稍后可再次显示出来. 快捷键: Shift + F3 &lt;img src="https://slimenull.com/images/20210222005447324.gif"
loading="lazy"
alt="在这里插入图片描述"
>&lt;/li>
&lt;/ol>
&lt;h4 id="2-sharex">2. ShareX:&lt;/h4>
&lt;h5 id="简述-5">简述:&lt;/h5>
&lt;ul>
&lt;li>好了好了! 大佬要来了! ShareX 可谓是一个非常强大的程序, 截图, 取色器, 屏幕取色器, 屏幕录制, 屏幕录制(GIF), 图像上传(到图床), 视频转格式,&lt;/li>
&lt;/ul>
&lt;h5 id="程序图">程序图:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/20210222011734713.png"
loading="lazy"
alt="ShareX程序界面"
>&lt;/p>
&lt;h5 id="支持的功能">支持的功能:&lt;/h5>
&lt;p>写这么多真的是累死我了&amp;hellip; 反正看这个界面图也差不多理解了, 我就截几个图放出来好了. 但是! ShareX 是一个超级厉害的软件啊啊啊啊! 一定要试试!&lt;/p>
&lt;ol>
&lt;li>截图
&lt;img src="https://slimenull.com/images/20210222011931593.png"
loading="lazy"
alt="ShareX屏幕截图"
>&lt;/li>
&lt;li>工具:
&lt;img src="https://slimenull.com/images/20210222012041987.png"
loading="lazy"
alt="ShareX工具"
>&lt;/li>
&lt;li>快捷键编辑:
&lt;img src="https://slimenull.com/images/2021022201215764.png"
loading="lazy"
alt="ShareX"
>&lt;/li>
&lt;/ol>
&lt;h2 id="最后说两句">最后说两句:&lt;/h2>
&lt;ul>
&lt;li>贴纸功能是真的好用啊淦! 我写文章的时候, 直接把 ShareX 的程序界面截取, 然后贴在屏幕上, 就可以慢慢一个个介绍了!&lt;/li>
&lt;li>总的来说, 储了最开始那个老工具和Win10截屏快捷键, 我还是都挺推荐的! 平常使用我一直用的 Snipaste, 截图和贴纸最常用, 然后录制 GIF 的时候, 就使用 ShareX. 毕竟录制 GIF 无非在 QQ 里发一些奇妙内容, 而没有多少人愿意去用 MP4 格式. 因为 GIF 自动播放的. (尽管大多数情况, MP4比GIF小, 质量又好)&lt;/li>
&lt;li>然后!!! 我再吹一波 ShareX! ShareX 的 GIF 录制是真的厉害! 我完全不知道它是如何压缩的图片大小. 质量非常棒! 而且 ShareX 的 MP4 录制, 大小压缩的是真的彳亍! Data Rate 仅有 397 kbps 的情况下, 居然完全能够保证质量! (听朋友说是压缩算法, 计算运动轨迹什么的, 估计仅在屏幕单调内容录制的情况下效果好.)&lt;/li>
&lt;/ul></description></item><item><title>[C#] 就让这张图片来揭露你的本性吧! 老绅士.</title><link>https://slimenull.com/p/20210221230837/</link><pubDate>Sun, 21 Feb 2021 23:08:37 +0800</pubDate><guid>https://slimenull.com/p/20210221230837/</guid><description>&lt;p>&lt;img src="https://slimenull.com/images/20210212012512552.jpg"
loading="lazy"
alt="qwq"
>
看到上面那幅图了吗? 放大, 放大, 看到了吗? 说的就是你 .&lt;/p>
&lt;h2 id="淦">淦!&lt;/h2>
&lt;h4 id="1-正常的">1. 正常的:&lt;/h4>
&lt;p>简单的, 就是最开始那张图片了, 看起来还彳亍, 对吧&lt;/p>
&lt;p>好吧, 这种东西, 实现起来也不难, 无非是在图片中写字. 写字你总会吧? 我直接贴 Graphics 元数据:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">namespace&lt;/span> &lt;span class="nn">System.Drawing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 摘要:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 封装一个 GDI+ 绘图图面。 此类不能被继承。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">sealed&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">Graphics&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">MarshalByRefObject&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IDeviceContext&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IDisposable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 摘要:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 在指定位置并且用指定的 System.Drawing.Brush 和 System.Drawing.Font 对象绘制指定的文本字符串。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 参数:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// s:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 要绘制的字符串。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// font:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// System.Drawing.Font，它定义字符串的文本格式。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// brush:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// System.Drawing.Brush，它确定所绘制文本的颜色和纹理。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// point:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// System.Drawing.PointF 结构，它指定所绘制文本的左上角。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 异常:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// T:System.ArgumentNullException:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// brush 为 null。 或 - s 为 null。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">DrawString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Font&lt;/span> &lt;span class="n">font&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Brush&lt;/span> &lt;span class="n">brush&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PointF&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>懂了吧? 当然本程序可没那么简单嘿嘿! 我可是还实现了类似于蒙版的东西! (好吧也不是很难)&lt;/p>
&lt;h5 id="2-难一点的">2. 难一点的:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/20210220205921619.jpg"
loading="lazy"
>
看出有什么区别没? 没错! 你发现, 背景变成单色, 而字变成彩色的了!!! 当然 PS 用剪切蒙版很容易实现. 那么, 用 C# 该如何实现呢?&lt;/p>
&lt;p>首先创建一个位图, 作为我们的临时空间, 背景是黑色, 然后用白色的笔在上面写字. 哦豁, 这不就是一张蒙版吗?&lt;/p>
&lt;p>我们的源图像跟这个蒙版图是一样大小的, 输出图像当然也同样大小, 然后遍历原图像的像素, 并且判断蒙版图像的颜色, 如果蒙版图像的颜色是白色, 则把这个像素拷贝到输出图像中. 于是于是! 就实现了画彩色的字! (好吧的确有点投机取巧的意味.)&lt;/p>
&lt;h5 id="3-简单点的">3. 简单点的:&lt;/h5>
&lt;p>&lt;img src="https://slimenull.com/images/20210221230415739.jpg"
loading="lazy"
>
哈哈哈, 每一个字, 都相当于原图的一个像素, 可不可以说是变相的字符画?&lt;/p>
&lt;h5 id="完整的内容介绍">完整的内容介绍:&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Null.CharImg: 字符图像混合工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Null.CharImg &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>CharWidth &lt;span class="p">|&lt;/span> CWidth&lt;span class="o">}&lt;/span> 字符占宽 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>CharHeight &lt;span class="p">|&lt;/span> CHeight&lt;span class="o">}&lt;/span> 字符占高 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>MaxWidth &lt;span class="p">|&lt;/span> MWidth&lt;span class="o">}&lt;/span> 最大宽度 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>MaxHeight &lt;span class="p">|&lt;/span> MHeight&lt;span class="o">}&lt;/span> 最大高度 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>FontSize &lt;span class="p">|&lt;/span> FSize&lt;span class="o">}&lt;/span> 字体大小 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>String &lt;span class="p">|&lt;/span> Str&lt;span class="o">}&lt;/span> 字符串内容 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>CorrectRate &lt;span class="p">|&lt;/span> CRate&lt;span class="o">}&lt;/span> 颜色矫正程度&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>BackgroundColor &lt;span class="p">|&lt;/span> BgColor&lt;span class="o">}&lt;/span> 背景颜色 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> -&lt;span class="o">{&lt;/span>FontFamily &lt;span class="p">|&lt;/span> Font&lt;span class="o">}&lt;/span> 字体 &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> /&lt;span class="o">{&lt;/span>FontBold &lt;span class="p">|&lt;/span> Bold&lt;span class="o">}&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> /&lt;span class="o">{&lt;/span>Opposite &lt;span class="p">|&lt;/span> Oppo&lt;span class="o">}&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> /&lt;span class="o">{&lt;/span>AutoCorrect &lt;span class="p">|&lt;/span> Correct&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> /&lt;span class="o">{&lt;/span>AutoBackground &lt;span class="p">|&lt;/span> AutoBg&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> /&lt;span class="o">{&lt;/span>HighDefinition &lt;span class="p">|&lt;/span> HD&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&lt;span class="o">{&lt;/span>Output &lt;span class="p">|&lt;/span> Out&lt;span class="o">}&lt;/span> 输出路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *源文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Null.CharImg /&lt;span class="o">{&lt;/span>Help &lt;span class="p">|&lt;/span> H &lt;span class="p">|&lt;/span> ?&lt;span class="o">}&lt;/span> 显示本帮助内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 其中参数的概述如下:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 字符占宽, 指图像中, 一个字符独占的宽度, 默认8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 字符占高, 字符独占的高度, 与字符占宽决定了字符的间距, 默认16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 最大宽度, 指输出图像中, 横向最多含多少个字符
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 最大高度, 指输出图像中, 纵向最多含多少个字符
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 字体大小, 指字体大小, 单位是像素, 默认16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 字符串内容, 要显示在图像中的字符, 将逐个显示
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 颜色矫正程度, 指定了自动颜色矫正的程度, 值域是0~100, 默认100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 背景颜色, 表示图像背景颜色, 使用十六进制代码表示
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 输出路径, 表示输出图像的保存路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 字体, 表示图像中字符所使用的字体, 默认是Sans Serif
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FontBold, 粗体, 表示是否使用粗体
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Opposite, 使背景与前景颜色反转
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AutoCorrect, 自动矫正颜色
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AutoBackground, 自动判断背景色
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HighDefinition, 高分辨率模式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 关于自动矫正颜色:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 自动矫正颜色旨在尝试调节前景色的色彩, 以做到前景与背景结合时, 颜色
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 趋近于原图, 如果背景颜色指定了亮度较高的颜色, 例如白色, 这个功能会
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 启到很好的作用, 如果你认为颜色矫正有些严重, 可以使用 CorrectRate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 参数来指定自动调节的力度, 尝试调节为80, 甚至更低的值来适应.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 关于自动判断背景色
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 当启动该功能时, 用户设置的颜色作废, 程序会自动计算整个原图像的平均色
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 作为输出图像的背景色
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 关于高分辨率模式:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 当启用高分辨率时, 图像中的一个字符不再单单是一种颜色, 而是使用彩色,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 以使输出图像更能趋近于原图的形状与颜色, 同时Opposite也是受支持的
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 关于程序:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 作者: 诺尔, Null&lt;span class="p">;&lt;/span> 擅长:摸鱼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Github仓库: https://github.com/SlimeNull/Null.CharImg
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>如果有啥感到迷惑的, 在下方留言噢~&lt;/p>
&lt;/blockquote></description></item><item><title>[C#] 音乐播放 3 种方式 Demo 与 MCI 音乐播放器封装类.</title><link>https://slimenull.com/p/20210211104239/</link><pubDate>Thu, 11 Feb 2021 10:42:39 +0800</pubDate><guid>https://slimenull.com/p/20210211104239/</guid><description>&lt;h2 id="淦">淦!&lt;/h2>
&lt;p>首先代码是不完整的, 我还是没能成功设置音量, 除此之外, 别的倒是挺顺利的, 当前实现的功能如下:&lt;/p>
&lt;blockquote>
&lt;p>播放 暂停 还原 停止 获取进度 获取长度 设置进度 获取播放状态&lt;/p>
&lt;/blockquote>
&lt;h2 id="内容">内容:&lt;/h2>
&lt;ul>
&lt;li>本项目的仓库在: &lt;a id="download_link" href="https://github.com/SlimeNull/AudioTest">SlimeNull/AudioTest&lt;/a>, 在这里下载哦, 别忘了还原 nuget 包, 因为用了 NAudio 库.&lt;/li>
&lt;/ul>
&lt;h4 id="-音乐播放-demo">&amp;gt; 音乐播放 Demo:&lt;/h4>
&lt;ul>
&lt;li>先放图吧:&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://slimenull.com/images/20210211102257257.png"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>首先左上角是打开文件的, 然后 PlayType 是播放方式, 我现在让它支持 3 种, 一种是SoundPlayer, 然后是 MCI, 然后是 NAudio 库.
 
实现了播放, 暂停, 停止, 移除, 进度调整到开头, 进度调整(就那个track bar), 同步播放(如果点了这个, UI线程会阻塞的哦), 获取音乐长度, 获取播放状态, 获取播放位置, 重复播放.
 
不同的功能对不同的播放种类支持性不同, 所以, 如果你按下了按钮, 没反应, 也没报错, 那就是它不支持这个功能(也就是代码里没有写)'&lt;/p>
&lt;/blockquote>
&lt;p>下载代码, 请看前面的链接.&lt;a class="link" href="#download_link" >↑跳转↑&lt;/a>&lt;/p>
&lt;h4 id="-mci-播放器封装">&amp;gt; MCI 播放器封装:&lt;/h4>
&lt;ul>
&lt;li>上边的窗体程序就体现了封装类所实现的所有功能喔, 所以试试吧, 你也可以直接粘贴下面的代码, 但是cs文件的名称, 如果可以的话, 我希望你命名为 &amp;ldquo;Null.MciPlayer&amp;rdquo; &lt;sub>(没错就是我的名字&lt;/sub>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;span class="lnt">252
&lt;/span>&lt;span class="lnt">253
&lt;/span>&lt;span class="lnt">254
&lt;/span>&lt;span class="lnt">255
&lt;/span>&lt;span class="lnt">256
&lt;/span>&lt;span class="lnt">257
&lt;/span>&lt;span class="lnt">258
&lt;/span>&lt;span class="lnt">259
&lt;/span>&lt;span class="lnt">260
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">System&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">System.IO&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">System.Runtime.InteropServices&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">namespace&lt;/span> &lt;span class="nn">Null.MciPlayer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">MciPlayer&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">IDisposable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na"> [DllImport(&amp;#34;kernel32.dll&amp;#34;, EntryPoint = &amp;#34;GetShortPathNameW&amp;#34;, CharSet = CharSet.Unicode)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">extern&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">GetShortPath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">longPath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">bufferSize&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na"> [DllImport(&amp;#34;winmm.dll&amp;#34;, EntryPoint = &amp;#34;mciSendString&amp;#34;, CharSet = CharSet.Unicode)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">extern&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">MciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">bufferSize&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">TryGetShortPath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">longPath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">out&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">shortPath&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shortPath&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">short&lt;/span> &lt;span class="n">reqLen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GetShortPath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">longPath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 指定 null与0, 则返回需要的长度&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reqLen&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shortPath&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">reqLen&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 声明缓冲&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">short&lt;/span> &lt;span class="n">rstLen&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GetShortPath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">longPath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shortPath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">reqLen&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 转换&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">rstLen&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="p">||&lt;/span> &lt;span class="n">rstLen&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="n">reqLen&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shortPath&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">shortPath&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TrimEnd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">longpath&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">aliasName&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">MciPlayer&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">MciPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">File&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FileNotFoundException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;File not exist.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">longpath&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">void&lt;/span> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">bufferSize&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">MciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">bufferSize&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span> &lt;span class="p">!=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">MciException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">StatusInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">32&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;status {aliasName} {info}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TrimEnd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">DevicePath&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="n">longpath&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">DeviceShortPath&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">AliasName&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="n">aliasName&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="n">SetDevicePath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">longpath&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">aliasName&lt;/span> &lt;span class="p">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">longpath&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">longpath&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Open&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">TryGetShortPath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">longpath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">out&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Exception&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Get short path faield when initializing.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">aliasName&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">$&amp;#34;nmci{DateTime.Now.Ticks}&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;open {shortName} alias {aliasName}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;close {aliasName}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">aliasName&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Play&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;play {aliasName}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Resume&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;resume {aliasName}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Pause&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;pause {aliasName}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Stop&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;stop {aliasName}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">GetPosition&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StatusInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;position&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">GetLength&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StatusInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;length&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">PlaybackState&lt;/span> &lt;span class="n">GetState&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">StatusInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mode&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">ToLower&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;playing&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">PlaybackState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Playing&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;paused&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">PlaybackState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Paused&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;stopped&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">PlaybackState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Stopped&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">PlaybackState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Invalid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">PlayWait&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;play {aliasName} wait&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">PlayRepeat&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;play {aliasName} repeat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">position&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;seek {aliasName} to {position}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">SeekToStart&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;seek {aliasName} to start&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">SetSeekMode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">bool&lt;/span> &lt;span class="n">fExact&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MciSendStringWithCheck&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;set {aliasName} seek exactly {(fExact ? &amp;#34;&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="s">&amp;#34; : &amp;#34;&lt;/span>&lt;span class="n">off&lt;/span>&lt;span class="s">&amp;#34;)}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Dispose&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">aliasName&lt;/span> &lt;span class="p">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Close&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">PlaybackState&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Stopped&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Playing&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Paused&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Invalid&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">MciException&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">Exception&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">MciError&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">ErrorId&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">ErrorName&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToString&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">override&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">Message&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="n">ErrorName&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">MciException&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">MciException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">errorId&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Enum&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IsDefined&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">typeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MciError&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">errorId&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">MciError&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">errorId&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ArgumentOutOfRangeException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;不是正确的错误ID&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">MciException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">errorName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">Enum&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TryParse&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">MciError&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="n">errorName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">out&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ArgumentOutOfRangeException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;不是正确的错误ID&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">enum&lt;/span> &lt;span class="n">MciError&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NO_ERROR&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_INVALID_DEVICE_ID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">257&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_UNRECOGNIZED_KEYWORD&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">259&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_UNRECOGNIZED_COMMAND&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">261&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_HARDWARE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">262&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_INVALID_DEVICE_NAME&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">263&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_OUT_OF_MEMORY&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">264&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_OPEN&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">265&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_CANNOT_LOAD_DRIVER&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">266&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_MISSING_COMMAND_STRING&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">267&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_PARAM_OVERFLOW&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">268&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_MISSING_STRING_ARGUMENT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">269&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_BAD_INTEGER&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">270&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_PARSER_INTERNAL&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">271&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DRIVER_INTERNAL&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">272&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_MISSING_PARAMETER&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">273&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_UNSUPPORTED_FUNCTION&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">274&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_FILE_NOT_FOUND&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">275&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_NOT_READY&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">276&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_INTERNAL&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">277&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DRIVER&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">278&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_CANNOT_USE_ALL&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">279&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_MULTIPLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">280&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_EXTENSION_NOT_FOUND&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">281&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_OUTOFRANGE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">282&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_FLAGS_NOT_COMPATIBLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">284&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_FILE_NOT_SAVED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">286&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_TYPE_REQUIRED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">287&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_LOCKED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">288&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DUPLICATE_ALIAS&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">289&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_BAD_CONSTANT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">290&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_MUST_USE_SHAREABLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">291&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_MISSING_DEVICE_NAME&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">292&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_BAD_TIME_FORMAT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">293&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NO_CLOSING_QUOTE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">294&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DUPLICATE_FLAGS&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">295&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_INVALID_FILE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">296&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NULL_PARAMETER_BLOCK&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">297&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_UNNAMED_RESOURCE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">298&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NEW_REQUIRES_ALIAS&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">299&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NOTIFY_ON_AUTO_OPEN&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">300&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NO_ELEMENT_ALLOWED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">301&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NONAPPLICABLE_FUNCTION&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">302&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_ILLEGAL_FOR_AUTO_OPEN&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">303&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_FILENAME_REQUIRED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">304&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_EXTRA_CHARACTERS&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">305&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_NOT_INSTALLED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">306&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_GET_CD&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">307&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SET_CD&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">308&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SET_DRIVE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">309&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_LENGTH&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">310&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_DEVICE_ORD_LENGTH&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">311&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NO_INTEGER&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">312&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_OUTPUTSINUSE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">320&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_SETOUTPUTINUSE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">321&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_INPUTSINUSE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">322&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_SETINPUTINUSE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">323&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_OUTPUTUNSPECIFIED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">324&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_INPUTUNSPECIFIED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">325&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_OUTPUTSUNSUITABLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">326&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_SETOUTPUTUNSUITABLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">327&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_INPUTSUNSUITABLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">328&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_WAVE_SETINPUTUNSUITABLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">329&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_DIV_INCOMPATIBLE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">336&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_PORT_INUSE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">337&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_PORT_NONEXISTENT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">338&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_PORT_MAPNODEVICE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">339&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_PORT_MISCERROR&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">340&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_TIMER&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">341&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_PORTUNSPECIFIED&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">342&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_SEQ_NOMIDIPRESENT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">343&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NO_WINDOW&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">346&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_CREATEWINDOW&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">347&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_FILE_READ&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">348&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_FILE_WRITE&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">349&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERR_NO_IDENTITY&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">350&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>&lt;br/>&lt;br/>&lt;br/>&lt;br/>&lt;br/>
如果有什么建议或者这个类有可改进的地方, 欢迎留言哦~ n(*≧▽≦*)n&lt;/p></description></item><item><title>[C#] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整,</title><link>https://slimenull.com/p/20210211102111/</link><pubDate>Thu, 11 Feb 2021 10:21:11 +0800</pubDate><guid>https://slimenull.com/p/20210211102111/</guid><description>&lt;h2 id="淦">淦!&lt;/h2>
&lt;p>琢磨了一晚上啊, 总算有些眉目了. &lt;sub>(所以我还是一个笨蛋啊, 明明这么简单的东西却花费了这么长时间&lt;/sub>&lt;/p>
&lt;p>首先, MCI的全称是Multimedia Control Interface, 即多媒体控制接口, 通过它, 我们可以做到播放音频视频, 甚至录制音频, 虽然古老, 但是真的强大.&lt;/p>
&lt;p>注意, 文章较官方文档有不少删减, 如果看标准内容, 还是看官方文档比较好.&lt;/p>
&lt;blockquote>
&lt;p>MCI Command Strings 官方文档: &lt;a class="link" href="https://docs.microsoft.com/en-us/windows/win32/multimedia/mci-command-strings" target="_blank" rel="noopener"
>Microsoft Command Strings - Win32 app | Microsoft Docs&lt;/a>
哦对了, 文档是纯英文哦~&lt;/p>
&lt;/blockquote>
&lt;h2 id="理论基础">理论基础:&lt;/h2>
&lt;ol>
&lt;li>MCI 不能与 C# 中的内存流打交道, 他只能播放文件.&lt;/li>
&lt;li>MCI 支持很多格式, 包含: CD音频, 数字音频, MIDI音乐, 视频唱片(videodisc), VCR, 以及波形音频.&lt;/li>
&lt;li>MCI 中, 被播放的音频文件被称作 &lt;strong>设备(Device)&lt;/strong>&lt;/li>
&lt;li>MCI 中, 支持巨多设置项, 包括播放进度, 音量大小, 声道开关, 如果你播放的是 MIDI, 支持的设置更多.&lt;/li>
&lt;/ol>
&lt;h2 id="正式开始">正式开始:&lt;/h2>
&lt;p>下面, 我们将以播放音频为例, 尽可能多的讲述 MCI 的相关知识, 文章在今后可能会继续更新.&lt;/p>
&lt;p>示例文件在: C:\Users\Null\Desktop\Tutorial.wav&lt;/p>
&lt;h4 id="-引用库">&amp;gt; 引用库:&lt;/h4>
&lt;ul>
&lt;li>最最开始, 无非是载入库.&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>对于 C++, 需要引用 Windows.h 以及 Mmsystem.h 这两个头文件&lt;/li>
&lt;li>对于 C#, using System.Runtime.InteropServices; 以进行非托管库的调用.&lt;/li>
&lt;/ol>
&lt;h4 id="-执行指令">&amp;gt; 执行指令:&lt;/h4>
&lt;ul>
&lt;li>MCI 中, 有 3 种方式来执行 MCI 指令. 分别是: mciSendString, mciExecute, mciSendCommand, 它们均位于 winmm.dll 中.&lt;/li>
&lt;/ul>
&lt;h1 id="heading">&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>函数原型:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="n">MCIERROR&lt;/span> &lt;span class="nf">mciSendString&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="c1">// MCIERROR 是 无符号长整形数字
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">LPCTSTR&lt;/span> &lt;span class="n">lpszCommand&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LPTSTR&lt;/span> &lt;span class="n">lpszReturnString&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">UINT&lt;/span> &lt;span class="n">cchReturn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HANDLE&lt;/span> &lt;span class="n">hwndCallback&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BOOL&lt;/span> &lt;span class="nf">mciExecute&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LPCSTR&lt;/span> &lt;span class="n">pszCommand&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIERROR&lt;/span> &lt;span class="nf">mciSendCommand&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MCIDEVICEID&lt;/span> &lt;span class="n">IDDevice&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 设备 ID, 通过另一个函数打开文件可以获得
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">UINT&lt;/span> &lt;span class="n">uMsg&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DWORD_PTR&lt;/span> &lt;span class="n">fdwCommand&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DWORD_PTR&lt;/span> &lt;span class="n">dwParam&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>C# 声明方式:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[DllImport(&amp;#34;winmm.dll&amp;#34;, EntryPoint = &amp;#34;mciSendString&amp;#34;, CharSet = CharSet.Unicode)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">extern&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">ulong&lt;/span> &lt;span class="n">MciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">bufferSize&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">[DllImport(&amp;#34;winmm.dll&amp;#34;, EntryPoint = &amp;#34;mciExecute&amp;#34;, CharSet = CharSet.Unicode)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">extern&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="n">MciExecute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">[DllImport(&amp;#34;winmm.dll&amp;#34;, EntryPoint = &amp;#34;mciSendCommand&amp;#34;, CharSet = CharSet.Unicode)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">extern&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">ulong&lt;/span> &lt;span class="n">MciSendCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">uint&lt;/span> &lt;span class="n">deviceId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="n">uMsg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">fdwCommand&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span> &lt;span class="n">dwParam&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>简略说明:&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>mciSendString: 最常用的方法, 通过字符串来表示一个指令, 会返回错误码, 不会有弹窗警告
mciExecute: 调试时较常用的方法, 在执行时若有未完善的地方, 会弹窗警告, 也因为如此, 程序的发布版本不会使用这个(影响使用体验)
mciSendCommand: 很少用, 通过指令的ID来表示指令, 会返回错误码, 不会有弹窗警告
 
某些 MCI 指令具有返回值, 例如获取播放状态, 这些指令不能通过mciExecute执行.&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ul>
&lt;h1 id="heading-1">&lt;/h1>
&lt;ul>
&lt;li>文章只会通过 mciSendString 来介绍 MCI 哟&lt;/li>
&lt;/ul>
&lt;h4 id="-打开文件">&amp;gt; 打开文件:&lt;/h4>
&lt;ul>
&lt;li>对于播放音频, 首要的第一件事, 肯定就是打开文件并将其载入到内存了. 不过有一点很重要, 就是 MCI 指令只支持短路径(ShortPath), 所以在拿到文件路径后, 我们得将其转换为短路径.&lt;/li>
&lt;li>如果不对路径进行转换, 那么某些名字长度大于8的文件(准确来说是路径中任何一部分长度大于8)的将无法播放
&lt;blockquote>
&lt;p>关于短路径与长路径: &lt;a class="link" href="https://blog.csdn.net/zfs2008zfs/article/details/51154873" target="_blank" rel="noopener"
>windows系统下的文件长名和文件短名&lt;/a>
短路径与长路径的转换: &lt;a class="link" href="https://slimenull.com/p/20210209080535/" >[C#/C/C++] GetShortPathName 详解, 长路径转换为短路径&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>MCI 指令中, 通过 open 来打开一个文件, 并且在末尾还可以使用 &amp;ldquo;alias 别名&amp;rdquo; 来为这个已打开的文件起一个别名.&lt;/li>
&lt;li>下面是两个示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 文件是 C:\Users\Null\Desktop\Tutorial.wav&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 转换为短路径是 C:\Users\Null\Desktop\Tut~1.wav&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;open C:\Users\Null\Desktop\Tut~1.wav&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;open C:\Users\Null\Desktop\Tut~1.wav alias tutorial&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>在第一的 mciSendString 中, 很清晰明了, 打开了一个文件, 而第二个中, 我们还加了一个alias, 即, 别名, MCI支持为打开的文件起一个别名, 并且推荐这么做.
第二个种, 我们为它起的别名是 tutorial.&lt;/li>
&lt;/ul>
&lt;h4 id="-播放音频">&amp;gt; 播放音频:&lt;/h4>
&lt;ul>
&lt;li>播放音频的 MCI 指令是 play, 直接 &amp;ldquo;play 设备&amp;rdquo;&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;play C:\Users\Null\Desktop\Tut~1.wav&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;play tutorial&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>如果你没有为文件指定别名, 那么在使用 play 指令时, 只能指定短路径
如果你为文件指定了别名, 直接play加上别名即可播放这个文件.&lt;/li>
&lt;/ul>
&lt;h4 id="-重复播放音频">&amp;gt; 重复播放音频:&lt;/h4>
&lt;ul>
&lt;li>这里, 用到了参数, 就像alias一样, 可选. 重复播放还是使用的play指令.&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;play C:\Users\Null\Desktop\Tut~1.wav repeat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;play tutorial repeat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>设备名如旧, 可以直接指定短路径, 也可以指定别名, 而想做到重复播放, 只需要在最后指定repeat&lt;/li>
&lt;/ul>
&lt;h4 id="-同步播放音频">&amp;gt; 同步播放音频:&lt;/h4>
&lt;ul>
&lt;li>同样是参数, 这里是wait, 支持wait参数的指令可以同步执行, 例如play指令&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;play C:\Users\Null\Desktop\Tut~1.wav wait&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;play tutorial wait&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>执行后, 将会阻塞当前现成, 直至播放结束.&lt;/li>
&lt;/ul>
&lt;h4 id="-暂停播放">&amp;gt; 暂停播放:&lt;/h4>
&lt;ul>
&lt;li>暂停, pause, 用法很简单, 同样是 &amp;ldquo;pause 设备&amp;rdquo;&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;pause C:\Users\Null\Desktop\Tut~1.wav&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;pause tutorial&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>执行后, 正在播放的音频就会暂停.&lt;/li>
&lt;/ul>
&lt;h4 id="-恢复播放">&amp;gt; 恢复播放:&lt;/h4>
&lt;ul>
&lt;li>恢复, resume, 语法是 &amp;ldquo;resume 设备&amp;rdquo;&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;pause C:\Users\Null\Desktop\Tut~1.wav&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;pause tutorial&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>执行后, 暂停播放的音频就会恢复.&lt;/li>
&lt;/ul>
&lt;h4 id="-关闭文件">&amp;gt; 关闭文件:&lt;/h4>
&lt;ul>
&lt;li>关闭, close, 语法是: &amp;ldquo;close 设备&amp;rdquo;&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;close C:\Users\Null\Desktop\Tut~1.wav&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;close tutorial&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>执行后, 文件会被关闭. 如果音频正在播放, 则会停止.&lt;/li>
&lt;/ul>
&lt;h4 id="-改变播放位置">&amp;gt; 改变播放位置:&lt;/h4>
&lt;ul>
&lt;li>seek 指令, 这个指令比较复杂哦. 语法如下:
&lt;blockquote>
&lt;p>seek &lt;em>device&lt;/em> to &lt;em>position&lt;/em>
seek &lt;em>device&lt;/em> to start
seek &lt;em>device&lt;/em> to end&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>示例:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;seek tutorial to 1000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;seek tutorial to start&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;seek tutorial to end&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>短路径肯定是能用的哦, 我只是懒得写了, 至于 &amp;ldquo;seek &lt;em>device&lt;/em> to &lt;em>position&lt;/em>&amp;rdquo; 的用法, 其中position默认是ms为单位的整数时间哦, 也就是说, 1000代表1s.&lt;/li>
&lt;li>seek 的单位是可以调整的, 继续看哦&lt;/li>
&lt;/ul>
&lt;h4 id="-设置相关">&amp;gt; 设置相关:&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>设置, set, 这个支持的就更多了&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>以下是适用于 CD Audio 的语法 :&lt;/strong>
set &lt;em>device&lt;/em> time format milliseconds
set &lt;em>device&lt;/em> time format msf
set &lt;em>device&lt;/em> time format tmsf&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;strong>以下是适用于 Wave Audio 的语法 :&lt;/strong>
set &lt;em>device&lt;/em> any input
set &lt;em>device&lt;/em> any output
set &lt;em>device&lt;/em> channels &lt;em>channel_count&lt;/em>
set &lt;em>device&lt;/em> format tag pcm
set &lt;em>device&lt;/em> format tag tag
set &lt;em>device&lt;/em> input &lt;em>integer&lt;/em>
set &lt;em>device&lt;/em> output &lt;em>integer&lt;/em>
set &lt;em>device&lt;/em> time format bytes
set &lt;em>device&lt;/em> time format milliseconds&lt;/p>
&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>选项&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>time format milliseconds&lt;/td>
&lt;td>将时间格式设置为毫秒, 所有使用position值的指令都将采用毫秒作为单位, 你可以将milliseconds缩写为ms. 对于音序器设备,&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>time format msf&lt;/td>
&lt;td>设置时间格式到 分钟, 妙, 以及帧. 所有使用position值的指令都见采用MSF格式(CD音频的默认格式), 请将MSF值指定为 mm:ss:ff 的格式, mm是分钟, ss是秒, ff是帧. 如果一个字段以及后面的字段都是0, 你可以忽略掉它. 例如, 3, 3:0, 3:0:0 都是表示3分钟的正确方式. MSF字段有以下最大值, 分钟:99, 秒:59, 帧: 74.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>time format tmsf&lt;/td>
&lt;td>将时间格式设置为 音轨, 分钟, 秒, 以及帧. 所有使用position值的指令都见采用TMSF格式, 额, 与上面的一样, 只不过多了个音轨. 音轨的最大值是99, 分钟, 秒, 帧的最大值与MSF格式一致.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>any input&lt;/td>
&lt;td>当录制时, 使用所有支持当前格式的输入, 这是默认设置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>any output&lt;/td>
&lt;td>当播放时, 使用所有支持当前格式的输出, 这是默认的&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>time format bytes&lt;/td>
&lt;td>在 PCM 文件格式中, 设置时间格式(单位)为字节, 指定这个指令后, 所有position信息都将被指定为字节格式&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;/ul>
&lt;h4 id="-状态信息">&amp;gt; 状态信息:&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>状态, status, 语法: &amp;ldquo;status &lt;em>device&lt;/em> &lt;em>option&lt;/em>&amp;rdquo;, 返回到 mciSendString 参数指定的字符串缓冲区&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>适用于音频的常用语法&lt;/strong>&lt;/p>
&lt;p>status &lt;em>device&lt;/em> position&lt;/p>
&lt;p>status &lt;em>device&lt;/em> length&lt;/p>
&lt;p>status &lt;em>device&lt;/em> mode&lt;/p>
&lt;p>status &lt;em>device&lt;/em> time format&lt;/p>
&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>选项&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>position&lt;/td>
&lt;td>获取目前播放的位置单位与时间格式统一&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>length&lt;/td>
&lt;td>获取当前播放音频的长度 单位与时间格式统一&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>mode&lt;/td>
&lt;td>获取播放状态, 返回的值是以下值之一: stopped / playing / paused&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>time format&lt;/td>
&lt;td>获取当前的时间格式&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">string&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">256&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 分配一个长度的字符串用来存放返回值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mciSendString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;status tutorial position&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">256&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IntPtr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Zero&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 调用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WriteLine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TrimEnd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span> &lt;span class="c1">// 打印返回值, TrimEnd的原因字符串的是长度是256, 函数没有使用的部分仍然是 \0 字符.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="-音频设置">&amp;gt; 音频设置&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>设置音频, setaudio, 语法 &amp;ldquo;setaudio &lt;em>device&lt;/em> &lt;em>option&lt;/em>&amp;rdquo;&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>常用语法:&lt;/strong>&lt;/p>
&lt;p>setaudio &lt;em>device&lt;/em> left volume to &lt;em>factor&lt;/em>&lt;/p>
&lt;p>setaudio &lt;em>device&lt;/em> right volume to &lt;em>factor&lt;/em>&lt;/p>
&lt;p>setaudio &lt;em>device&lt;/em> volume to &lt;em>factor&lt;/em>&lt;/p>
&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>选项&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>left/right volume to &lt;em>factor&lt;/em>&lt;/td>
&lt;td>将指定声道的音量设置为指定值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>volume to &lt;em>factor&lt;/em>&lt;/td>
&lt;td>将音量设置为指定值&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;/ul>
&lt;h2 id="错误码">错误码:&lt;/h2>
&lt;ul>
&lt;li>下面是sendMciString会返回的错误码以及描述(对名称翻译, 然后稍加校正), 哦对了, 返回 0 代表无错误哦
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>错误码&lt;/th>
&lt;th>名称&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>257&lt;/td>
&lt;td>MCIERR_INVALID_DEVICE_ID&lt;/td>
&lt;td>无效设备 ID&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>259&lt;/td>
&lt;td>MCIERR_UNRECOGNIZED_KEYWORD&lt;/td>
&lt;td>未识别关键字&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>261&lt;/td>
&lt;td>MCIERR_UNRECOGNIZED_COMMAND&lt;/td>
&lt;td>未识别的命令&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>262&lt;/td>
&lt;td>MCIERR_HARDWARE&lt;/td>
&lt;td>硬件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>263&lt;/td>
&lt;td>MCIERR_INVALID_DEVICE_NAME&lt;/td>
&lt;td>无效的设备名称&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>264&lt;/td>
&lt;td>MCIERR_OUT_OF_MEMORY&lt;/td>
&lt;td>内存不足&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>265&lt;/td>
&lt;td>MCIERR_DEVICE_OPEN&lt;/td>
&lt;td>设备打开&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>266&lt;/td>
&lt;td>MCIERR_CANNOT_LOAD_DRIVER&lt;/td>
&lt;td>无法加载驱动程序&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>267&lt;/td>
&lt;td>MCIERR_MISSING_COMMAND_STRING&lt;/td>
&lt;td>缺少命令字符串&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>268&lt;/td>
&lt;td>MCIERR_PARAM_OVERFLOW&lt;/td>
&lt;td>参数溢出&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>269&lt;/td>
&lt;td>MCIERR_MISSING_STRING_ARGUMENT&lt;/td>
&lt;td>缺少字符串参数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>270&lt;/td>
&lt;td>MCIERR_BAD_INTEGER&lt;/td>
&lt;td>坏整数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>271&lt;/td>
&lt;td>MCIERR_PARSER_INTERNAL&lt;/td>
&lt;td>分析器内部 (估计是这个API内部对指令分析时出现的错误)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>272&lt;/td>
&lt;td>MCIERR_DRIVER_INTERNAL&lt;/td>
&lt;td>驱动程序内部&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>273&lt;/td>
&lt;td>MCIERR_MISSING_PARAMETER&lt;/td>
&lt;td>缺少参数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>274&lt;/td>
&lt;td>MCIERR_UNSUPPORTED_FUNCTION&lt;/td>
&lt;td>不支持的功能&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>275&lt;/td>
&lt;td>MCIERR_FILE_NOT_FOUND&lt;/td>
&lt;td>未找到文件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>276&lt;/td>
&lt;td>MCIERR_DEVICE_NOT_READY&lt;/td>
&lt;td>设备未就绪&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>277&lt;/td>
&lt;td>MCIERR_INTERNAL&lt;/td>
&lt;td>内部&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>278&lt;/td>
&lt;td>MCIERR_DRIVER&lt;/td>
&lt;td>驱动器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>279&lt;/td>
&lt;td>MCIERR_CANNOT_USE_ALL&lt;/td>
&lt;td>不能全部使用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>280&lt;/td>
&lt;td>MCIERR_MULTIPLE&lt;/td>
&lt;td>多个&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>281&lt;/td>
&lt;td>MCIERR_EXTENSION_NOT_FOUND&lt;/td>
&lt;td>未找到扩展&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>282&lt;/td>
&lt;td>MCIERR_OUTOFRANGE&lt;/td>
&lt;td>超出范围&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>284&lt;/td>
&lt;td>MCIERR_FLAGS_NOT_COMPATIBLE&lt;/td>
&lt;td>标志不兼容&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>286&lt;/td>
&lt;td>MCIERR_FILE_NOT_SAVED&lt;/td>
&lt;td>文件未保存&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>287&lt;/td>
&lt;td>MCIERR_DEVICE_TYPE_REQUIRED&lt;/td>
&lt;td>需要设备类型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>288&lt;/td>
&lt;td>MCIERR_DEVICE_LOCKED&lt;/td>
&lt;td>设备已锁定&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>289&lt;/td>
&lt;td>MCIERR_DUPLICATE_ALIAS&lt;/td>
&lt;td>重复别名&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>290&lt;/td>
&lt;td>MCIERR_BAD_CONSTANT&lt;/td>
&lt;td>坏常量&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>291&lt;/td>
&lt;td>MCIERR_MUST_USE_SHAREABLE&lt;/td>
&lt;td>必须使用可共享&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>292&lt;/td>
&lt;td>MCIERR_MISSING_DEVICE_NAME&lt;/td>
&lt;td>缺少设备名称&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>293&lt;/td>
&lt;td>MCIERR_BAD_TIME_FORMAT&lt;/td>
&lt;td>错误的时间格式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>294&lt;/td>
&lt;td>MCIERR_NO_CLOSING_QUOTE&lt;/td>
&lt;td>没有关闭中的引用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>295&lt;/td>
&lt;td>MCIERR_DUPLICATE_FLAGS&lt;/td>
&lt;td>重复标志&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>296&lt;/td>
&lt;td>MCIERR_INVALID_FILE&lt;/td>
&lt;td>无效文件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>297&lt;/td>
&lt;td>MCIERR_NULL_PARAMETER_BLOCK&lt;/td>
&lt;td>空参数块&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>298&lt;/td>
&lt;td>MCIERR_UNNAMED_RESOURCE&lt;/td>
&lt;td>未命名的资源&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>299&lt;/td>
&lt;td>MCIERR_NEW_REQUIRES_ALIAS&lt;/td>
&lt;td>新需要别名&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>300&lt;/td>
&lt;td>MCIERR_NOTIFY_ON_AUTO_OPEN&lt;/td>
&lt;td>自动打开时通知&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>301&lt;/td>
&lt;td>MCIERR_NO_ELEMENT_ALLOWED&lt;/td>
&lt;td>不允许任何元素&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>302&lt;/td>
&lt;td>MCIERR_NONAPPLICABLE_FUNCTION&lt;/td>
&lt;td>不可应用功能&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>303&lt;/td>
&lt;td>MCIERR_ILLEGAL_FOR_AUTO_OPEN&lt;/td>
&lt;td>非法自动打开&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>304&lt;/td>
&lt;td>MCIERR_FILENAME_REQUIRED&lt;/td>
&lt;td>需要文件名&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>305&lt;/td>
&lt;td>MCIERR_EXTRA_CHARACTERS&lt;/td>
&lt;td>额外字符 (可能是指多出了一些不需要的字符)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>306&lt;/td>
&lt;td>MCIERR_DEVICE_NOT_INSTALLED&lt;/td>
&lt;td>未安装设备&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>307&lt;/td>
&lt;td>MCIERR_GET_CD&lt;/td>
&lt;td>获取 CD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>308&lt;/td>
&lt;td>MCIERR_SET_CD&lt;/td>
&lt;td>设置 CD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>309&lt;/td>
&lt;td>MCIERR_SET_DRIVE&lt;/td>
&lt;td>设置驱动器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>310&lt;/td>
&lt;td>MCIERR_DEVICE_LENGTH&lt;/td>
&lt;td>设备长度&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>311&lt;/td>
&lt;td>MCIERR_DEVICE_ORD_LENGTH&lt;/td>
&lt;td>设备 ORD 长度&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>312&lt;/td>
&lt;td>MCIERR_NO_INTEGER&lt;/td>
&lt;td>无整数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>320&lt;/td>
&lt;td>MCIERR_WAVE_OUTPUTSINUSE&lt;/td>
&lt;td>波输出&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>321&lt;/td>
&lt;td>MCIERR_WAVE_SETOUTPUTINUSE&lt;/td>
&lt;td>波设置输出&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>322&lt;/td>
&lt;td>MCIERR_WAVE_INPUTSINUSE&lt;/td>
&lt;td>波输入使用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>323&lt;/td>
&lt;td>MCIERR_WAVE_SETINPUTINUSE&lt;/td>
&lt;td>波设置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>324&lt;/td>
&lt;td>MCIERR_WAVE_OUTPUTUNSPECIFIED&lt;/td>
&lt;td>波输出未指定&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>325&lt;/td>
&lt;td>MCIERR_WAVE_INPUTUNSPECIFIED&lt;/td>
&lt;td>波输入未指定&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>326&lt;/td>
&lt;td>MCIERR_WAVE_OUTPUTSUNSUITABLE&lt;/td>
&lt;td>波输出可居住&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>327&lt;/td>
&lt;td>MCIERR_WAVE_SETOUTPUTUNSUITABLE&lt;/td>
&lt;td>波设置通普通西装&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>328&lt;/td>
&lt;td>MCIERR_WAVE_INPUTSUNSUITABLE&lt;/td>
&lt;td>波输入可居住&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>329&lt;/td>
&lt;td>MCIERR_WAVE_SETINPUTUNSUITABLE&lt;/td>
&lt;td>波设置通图适合&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>336&lt;/td>
&lt;td>MCIERR_SEQ_DIV_INCOMPATIBLE&lt;/td>
&lt;td>Seq Div 不兼容&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>337&lt;/td>
&lt;td>MCIERR_SEQ_PORT_INUSE&lt;/td>
&lt;td>SEQ 端口 INUSE&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>338&lt;/td>
&lt;td>MCIERR_SEQ_PORT_NONEXISTENT&lt;/td>
&lt;td>Seq 端口不存在&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>339&lt;/td>
&lt;td>MCIERR_SEQ_PORT_MAPNODEVICE&lt;/td>
&lt;td>Seq 端口地图无设备&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>340&lt;/td>
&lt;td>MCIERR_SEQ_PORT_MISCERROR&lt;/td>
&lt;td>SEQ 杂项错误&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>341&lt;/td>
&lt;td>MCIERR_SEQ_TIMER&lt;/td>
&lt;td>SEQ 定时器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>342&lt;/td>
&lt;td>MCIERR_SEQ_PORTUNSPECIFIED&lt;/td>
&lt;td>SEQ 端口未指定&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>343&lt;/td>
&lt;td>MCIERR_SEQ_NOMIDIPRESENT&lt;/td>
&lt;td>SEQ 没有MIDI在场&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>346&lt;/td>
&lt;td>MCIERR_NO_WINDOW&lt;/td>
&lt;td>无窗口&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>347&lt;/td>
&lt;td>MCIERR_CREATEWINDOW&lt;/td>
&lt;td>创建窗口&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>348&lt;/td>
&lt;td>MCIERR_FILE_READ&lt;/td>
&lt;td>文件读取&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>349&lt;/td>
&lt;td>MCIERR_FILE_WRITE&lt;/td>
&lt;td>文件写入&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>350&lt;/td>
&lt;td>MCIERR_NO_IDENTITY&lt;/td>
&lt;td>无标识&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;/ul>
&lt;h2 id="封装类">封装类:&lt;/h2>
&lt;blockquote>
&lt;p>去这里吧, 在我的另一篇文章中 &lt;a class="link" href="https://slimenull.com/p/20210211104239/" >[C#] 音乐播放 3 种方式 Demo 与 MCI 音乐播放器封装类.&lt;/a> o(〃&amp;rsquo;▽&amp;rsquo;〃)o&lt;/p>
&lt;/blockquote>
&lt;h2 id="附加内容">附加内容:&lt;/h2>
&lt;ul>
&lt;li>下面是我的一些发现
&lt;blockquote>
&lt;ol>
&lt;li>WinForm 程序使用 MCI 是可以打开 MP3 文件的, 但是如果是控制台程序, 就会出现错误, 错误码266, &amp;ldquo;MCIERR_CANNOT_LOAD_DRIVER&amp;rdquo;&lt;/li>
&lt;li>MCI 的某些指令不能正常使用, 但其实并不是很影响, 例如, &amp;ldquo;set &lt;em>device&lt;/em> audio &lt;em>left/right&lt;/em> &lt;em>off/off&lt;/em>&amp;rdquo;, 无法正常使用.&lt;/li>
&lt;li>音量控制我目前还是没弄成&amp;hellip; 不过可以确认的是, 进度获取, 调整, 长度获取是没问题的, 有这些最基本的, 就差不多公用了呢&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;/li>
&lt;/ul>
&lt;p>放一张我写文章时的照片吧 , 原文贴的哪都是 (笑&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/20210209110959116.png"
loading="lazy"
alt="手动翻译, 淦"
>&lt;/p></description></item><item><title>「干货」 装机如此简单！Windows 与 Linux 通用装机方法。(无需VM虚拟机)</title><link>https://slimenull.com/p/20201213001156/</link><pubDate>Sun, 13 Dec 2020 00:11:56 +0800</pubDate><guid>https://slimenull.com/p/20201213001156/</guid><description>&lt;h2 id="windows-与-linux-通用装机方法">Windows 与 Linux 通用装机方法&lt;/h2>
&lt;h5 id="步骤概述">步骤概述：&lt;/h5>
&lt;ol>
&lt;li>准备安装介质&lt;/li>
&lt;li>从你喜欢的渠道下载ISO镜像&lt;/li>
&lt;li>将ISO写入到安装介质&lt;/li>
&lt;/ol>
&lt;h3 id="步骤">步骤：&lt;/h3>
&lt;h5 id="1-准备安装介质">1. 准备安装介质&lt;/h5>
&lt;p>旧时的安装介质指光盘，但现在，一般的，安装介质都指U盘。你需要准备一个U盘，这个U盘的数据将被完全擦除然后写入安装程序，所以，推荐使用空闲U盘，并且空间大小推荐8G左右，不要小于4G，可以大于8G(只不过有些浪费空间就是了)&lt;/p>
&lt;blockquote>
&lt;p>Windows10的镜像一般为4G左右，写入到U盘后大于4G
Linux镜像一般较小，大多4G以下，但是Kali Linux的镜像要大于4G
这就是为什么推荐8G U盘&lt;/p>
&lt;/blockquote>
&lt;h5 id="2-从你喜欢的渠道下载iso镜像">2. 从你喜欢的渠道下载ISO镜像&lt;/h5>
&lt;p>如果你希望你安装的系统是干净的，那么，你需要使用正确的渠道来下载系统镜像。&lt;/p>
&lt;ul>
&lt;li>安装 Windows 系统：
&lt;ul>
&lt;li>如果你有激活密钥或可以使用数字激活，建议你去 &lt;strong>&lt;a class="link" href="https://next.itellyou.cn/" target="_blank" rel="noopener"
>Next, I tell you&lt;/a>&lt;/strong> 下载镜像，你需要登录(这不会花费太长时间)，它也是支持QQ登录的，当然，如果你不想注册账户，也可以去旧的网站 &lt;strong>&lt;a class="link" href="https://next.itellyou.cn/" target="_blank" rel="noopener"
>MSDN I tell you&lt;/a>&lt;/strong> ， 但在旧的网站，你无法下载Windows10的最新版本 &lt;em>2004&lt;/em>&lt;/li>
&lt;li>如果你没有激活密钥, 你可以选择购买 Windows 激活码, 在 &lt;a class="link" href="https://www.microsoft.com/" target="_blank" rel="noopener"
>Microsoft 商城&lt;/a> 或 &lt;a class="link" href="https://search.jd.com/Search?keyword=Windows%E6%BF%80%E6%B4%BB%E7%A0%81" target="_blank" rel="noopener"
>京东&lt;/a>, &lt;a class="link" href="https://www.taobao.com/" target="_blank" rel="noopener"
>淘宝&lt;/a> 等电子商城中可以购买到, 购买后, 按照上面的步骤, 下载 Windows 系统镜像. 或者你可以先进行上面的步骤, 在提到的网站中下载镜像, 然后试用 Windows. 如果你想要使用系统激活工具, 一定要知道, 这是不合法的, 并且激活工具常常伴随着病毒, 这些病毒很难被处理掉. &lt;del>360或许可以搞定它们&lt;/del>. 如果你想要使用盗版软件(不需要你为其支付费用), 请参阅文章尾 &lt;em>硬盘安装&lt;/em>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>安装 Linux 系统：
&lt;ul>
&lt;li>不用讲了，Linux 的大部分发行版都是免费且开源，直接在官方网站即可下载到。&lt;a class="link" href="https://ubuntu.com/" target="_blank" rel="noopener"
>Ubuntu&lt;/a>， &lt;a class="link" href="https://www.debian.org/" target="_blank" rel="noopener"
>Debian&lt;/a>，&lt;a class="link" href="https://www.deepin.org/" target="_blank" rel="noopener"
>Deepin&lt;/a>，&lt;a class="link" href="https://www.kali.org/" target="_blank" rel="noopener"
>Kali&lt;/a>，&lt;a class="link" href="https://www.archlinux.org/" target="_blank" rel="noopener"
>Arch&lt;/a>，&lt;a class="link" href="https://www.centos.org" target="_blank" rel="noopener"
>CentOS&lt;/a>，&lt;a class="link" href="https://linuxmint.com" target="_blank" rel="noopener"
>Mint&lt;/a>，&lt;a class="link" href="https://www.redhat.com/" target="_blank" rel="noopener"
>Red Hat&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>提示：I tell you网站内的ed2k是一个特殊的下载地址，可视作p2p下载链接，推荐使用&lt;a class="link" href="https://dl.xunlei.com/" target="_blank" rel="noopener"
>迅雷&lt;/a>(别的软件可能对非技术人员不友好)
注意，大多数国内流行的ISO或GHO镜像下载网站都是&lt;strong>包含捆绑软件&lt;/strong>的&lt;strong>非官方原装系统&lt;/strong>！如果你要使用纯净系统，切记要仔细选择！&lt;/p>
&lt;/blockquote>
&lt;h5 id="3-将iso写入到介质">3. 将ISO写入到介质&lt;/h5>
&lt;p>写入到介质可不单单是将ISO作为压缩包打开并内容拷贝到U盘，这样是错误的操作！但是不必担心，同样，它也不是什么复杂的操作&lt;/p>
&lt;ul>
&lt;li>在 Windows 系统中，你需要一个小工具来制作安装介质，它就是&lt;a class="link" href="http://rufus.ie/" target="_blank" rel="noopener"
>Rufus&lt;/a>！， 一个仅有不到5MB的小工具，并且能够自动帮你检测可能缺失的内容！&lt;a class="link" href="http://rufus.ie/" target="_blank" rel="noopener"
>Rufus&lt;/a>的使用也非常简便，只需要选择设备，选择ISO镜像，点击开始即可(我是指, 其他配置内容默认不需要更改)。&lt;a class="link" href="http://rufus.ie" target="_blank" rel="noopener"
>进入Rufus官网&lt;/a>，&lt;a class="link" href="https://github.com/pbatard/rufus/releases/download/v3.13/rufus-3.13p.exe" target="_blank" rel="noopener"
>下载Rufus 3.13便携版&lt;/a>&lt;/li>
&lt;li>在Linux中，我们只需要借助一个‘dd’指令即可将ISO镜像写入到U盘，用法是：
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dd &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>‘输入文件’ &lt;span class="nv">of&lt;/span>&lt;span class="o">=&lt;/span>‘输出设备’
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用lsblk指令可以查看自己当前的接入的存储设备&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dd指令示例使用示例： dd if=&amp;#39;/home/username/ubuntu20.04lts.iso&amp;#39; of=&amp;#39;/dev/sda&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>在这里不得不提到一个问题，就是在 Linux 中使用 dd 指令写入 Windows 镜像到U盘，会出现无法安装的问题，但是使用 Rufus 写入就没问题。（可能是格式问题）&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>示例图像&lt;/th>
&lt;th>简介&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;/table>
&lt;p>&lt;img src="https://slimenull.com/images/20201212211500172.png"
loading="lazy"
alt="Rufus界面图像"
> | Rufus 的界面非常简洁, 仅有必要的选项，无任何附加功能，无论小白还是大神，都很适合使用&lt;/p>
&lt;p>&lt;img src="https://slimenull.com/images/20201212212942916.png"
loading="lazy"
alt="在这里插入图片描述"
>| 这是Ubuntu系统中，dd指令的帮助手册，不过对于只需要将ISO写入到U盘的我们，不需要看那么多内容，只需要知道if和of参数即可&lt;/p>
&lt;h5 id="4-开始安装">4. 开始安装&lt;/h5>
&lt;p>待写入完毕，安装准备已经完全就绪了！那么，下一步就是安装步骤了！&lt;/p>
&lt;ol>
&lt;li>
&lt;p>关闭计算机&lt;/p>
&lt;/li>
&lt;li>
&lt;p>插入准备好的安装介质，启动计算机&lt;/p>
&lt;/li>
&lt;li>
&lt;p>从U盘启动（有两种方式）：&lt;/p>
&lt;ol>
&lt;li>第一种：按下 &lt;em>选择引导&lt;/em> 的按键，它可能是 F12，但不同主板有不同的按键，Dell电脑的按键即是 F12。&lt;/li>
&lt;li>第二种：按下进入 &lt;em>启动配置&lt;/em> 的按键 ，在 &lt;em>启动配置&lt;/em> 中调整引导顺序至USB设备最顶级，重启电脑即可进入安装界面&lt;/li>
&lt;/ol>
&lt;p>&lt;em>若有疑问，可参阅这篇文章： &lt;a class="link" href="https://slimenull.com/p/20201212233309/" >进入BIOS/UEFI配置页面&lt;/a>&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>成功从U盘启动后，就已经进入到系统安装界面了。接下来，按照安装程序的提示进行即可。一般的，Linux系统的可定制性要比Windows高很多，而Windows的安装就简单了很多。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>享受新系统！&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;br/>&lt;br/>&lt;/p>
&lt;h4 id="硬盘安装">硬盘安装：&lt;/h4>
&lt;ul>
&lt;li>某些ISO镜像，例如国内较为流行的镜像下载网站提供的ISO，将其中的内容直接解压到某处，启动 setup.exe 即可安装，这种安装方式被称为 &lt;em>硬盘安装&lt;/em> ，并且一般的，这种安装方式都是一键傻瓜式安装，中途完全不需要用户进行任何干涉。&lt;/li>
&lt;li>下面列举一些国内的非官方镜像下载源：
&lt;blockquote>
&lt;p>&lt;a class="link" href="http://www.deepinghost.com/" target="_blank" rel="noopener"
>深度技术&lt;/a>， &lt;a class="link" href="http://www.ylmfeng.com/" target="_blank" rel="noopener"
>雨林木风&lt;/a>，&lt;a class="link" href="http://www.luobojiayuanxt.com/" target="_blank" rel="noopener"
>萝卜家园&lt;/a>，&lt;a class="link" href="http://www.dngs.co/" target="_blank" rel="noopener"
>电脑公司&lt;/a>，&lt;a class="link" href="http://www.xitongzhijia.net/" target="_blank" rel="noopener"
>系统之家&lt;/a>，&lt;a class="link" href="http://www.winfanqie.com/" target="_blank" rel="noopener"
>番茄花园&lt;/a>
&lt;font color="#EE6666">&lt;strong>注意，你几乎无法在国内流行镜像下载站获取原版镜像！这些都是包含捆绑的非原版镜像！并且极有可能侵犯了微软(Microsoft)的版权，在使用之前，慎重考虑！&lt;/strong>&lt;/font>&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>在下载到支持硬盘安装的ISO镜像后，使用任意压缩包管理软件(例如&lt;a class="link" href="https://www.7-zip.org/" target="_blank" rel="noopener"
>7zip&lt;/a>)打开，解压其中的内容到任意文件夹，但要求不可以在你要安装系统的分区，例如你要将系统安装到C盘，那就不可以将ISO文件解压到C盘。&lt;/li>
&lt;li>解压后，双击 setup.exe 按照自己的需要配置一下，如果看不懂，就直接点下一步，然后傻瓜式系统安装就开始了，解压来你需要做的就是等待安装了（喝杯Java提提神？&lt;/li>
&lt;li>安装完成后，享受新系统吧！（记得将所有捆绑的东西全部卸载&lt;/li>
&lt;/ul></description></item><item><title>[Win32] Windows API 函数后缀(A,W,ExA,ExW)的作用</title><link>https://slimenull.com/p/20201120033237/</link><pubDate>Fri, 20 Nov 2020 03:32:37 +0800</pubDate><guid>https://slimenull.com/p/20201120033237/</guid><description>&lt;blockquote>
&lt;p>资料来自网络, 在此整理到一起&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>A表示使用ANSI编码作为标准输入与输出流的文本编码&lt;/li>
&lt;li>W表示使用Unicode作为编码&lt;/li>
&lt;li>Ex表示拓展, 标注了Ex的winapi函数会比没有标Ex的函数多一些参数什么的, 可以说拓展了一些功能&lt;/li>
&lt;li>ExA 与 ExW 就是 A,W与Ex的结合了&lt;/li>
&lt;/ul></description></item></channel></rss>